<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.49" />

    

<title>Midnight Programmer</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Midnight Programmer"/>
<meta name="twitter:description" content="Programming For Fun"/>

<meta property="og:title" content="Midnight Programmer" />
<meta property="og:description" content="Programming For Fun" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://prashantkhandelwal.github.io/" />
<meta property="og:updated_time" content="2025-11-28T08:41:00&#43;00:00"/><meta property="og:site_name" content="Midnight Programmer" />


    


<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.css" media="print">


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

<link href="https://prashantkhandelwal.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Midnight Programmer" />
<link href="https://prashantkhandelwal.github.io/index.xml" rel="feed" type="application/rss+xml" title="Midnight Programmer" />


</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://prashantkhandelwal.github.io/">Midnight Programmer</a>
      </span>
      
      
      
      <div class="author-image">
        <img src="https://prashantkhandelwal.github.io//img/prashantk.jpg" alt="Author Image" class="img--circle img--headshot element--center"> 
      </div>
      
      <p class="site__description">
         Programming For Fun 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Midnight Programmer</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/archive/"><i class='fa fa-road'></i>
						<span>Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/top-posts/"><i class='fa fa-star fa-fw'></i>
						<span>Top Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/contact/"><i class='fa fa-envelope fa-fw'></i>
						<span>Contact</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/prashantkhandelwal" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="http://feeds.feedburner.com/MidnightProgrammer" rel="me"><i class="fa fa-rss fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://instagram.com/prashantkhandelwal" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/khandelwalprashant" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://medium.com/@prashantkhandelwal" rel="me"><i class="fab fa-medium fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy; 2025 Pashant Khandelwal
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/in/"><img style="border-width: 0;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/in/88x31.png" alt="Creative Commons License" class="thinglinkFiltered"></a>
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
<div class="post-list">
  
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/building-a-hidden-website-with-python-and-tor/">Building a Hidden Website with Python and Tor</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Nov 28, 2025
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/python">PYTHON</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/tor">TOR</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/web">WEB</a>
      
      
      
      
    </span>
    <div style="text-align: -webkit-center;">
<img src="/images/tor-python.png" alt="Tor Python" />
</div>

<p>In this post, I will walk through how you can create and host a simple website using Python and serve it as a Tor hidden service — nothing shady, just pure geeky fun.</p>

<p>Let’s begin by installing Tor. If you’re already familiar with the Tor browser, feel free to proceed. But if you’re new to it, you can learn more about the service <a href="https://www.torproject.org/">here</a>.</p>

<p>The Tor browser includes a Tor binary (<code>tor.exe</code>) that can be used to start a service or install it as a Windows service. To locate it, navigate to the folder where Tor is installed. On my system, it&rsquo;s located at: <code>D:\Programs\Tor Browser\Browser\TorBrowser\Tor</code>.</p>

<p>While the initial part of the path may vary depending on your installation location, the rest of the directory structure remains consistent.</p>

<p>Since we’re hosting a website using Python, there’s no need to launch the Tor Browser. Instead, we’ll start Tor as a service using the <code>tor.exe</code> binary. Normally, launching the Tor Browser automatically starts this service in the background, but when running it manually, we need a runtime configuration file (<code>torrc</code>). Below is a sample configuration file with minimal settings—just enough to get the site up and running. For security reasons we would like to have the Tor control port to be password protected . You can generate the password using the <code>tor.exe</code> with this command.</p>

<pre class="bush:shell">
tor.exe --hash-password Msft#win123
</pre>

<p>Copy the output of the above command and save it to the <code>torrc</code> file along with other configurations. Here is the final configuration file.</p>

<pre class="brush:shell">
ControlPort 9151
SOCKSPort 9050
HashedControlPassword 16:EA735EE7099CC752600CFC4A4BD2F0CE737BA55864A78711C7672E699C
</pre>

<p>The port settings mentioned above might differ on your system. If the service fails to start or your web application can’t connect to it, this is likely the cause.</p>

<p>Open command prompt in administrator mode if you are on Windows. Start the tor service by executing the below command.</p>

<pre class="brush:shell">
tor.exe -f <path to your torrc file>
</pre>

<p><img src="/images/tor-service-start.png" alt="TOR Service Start" /></p>

<p>If you do not want to get into a hassle of running this command for starting the service again and again, then you can install tor as a service. To do that use the <code>tor.exe</code> with <code>--service install</code> arguments and pass the <code>torrc</code> file path as a argument to <code>-f</code> flag.</p>

<pre class="brush:shell">
tor.exe --service install -options -f F:\code\torpy\torrc
</pre>

<p>On Windows, you can place the <code>torrc</code> file at <code>C:\Users\AppData\Roaming\tor</code>, which is the default location used by <code>tor.exe</code>. Once it&rsquo;s in place, you can run the command as shown below.</p>

<pre class="brush:shell">
tor.exe --service install
</pre>

<p>If you wish to delete the installed service, use the <code>sc</code> command available on Windows.</p>

<pre class="brush:shell">
sc delete tor
</pre>

<p>With the Tor service now running, create a new folder — feel free to name it <code>TorWeb</code> or anything you prefer. Inside this folder, set up a Python virtual environment and install the necessary dependencies to enable communication with the Tor service.</p>

<pre class="brush:shell">
pip install stem flask
</pre>

<p>Here is the entire Python code.</p>

<pre class="brush:python">
from stem.control import Controller
from flask import Flask, render_template

if __name__ == "__main__":

    app = Flask("TorWeb")
    port = 5000
    host = "127.0.0.1"
    hidden_svc_dir = "e:/web"

    @app.route('/')
    def index():
        return render_template('index.html')
    
    print('* Getting controller')
    controller = Controller.from_port(address="127.0.0.1", port=9151)
    try:
        controller.authenticate(password="Msft#win123")
        controller.set_options([
            ("HiddenServiceDir", hidden_svc_dir),
            ("HiddenServicePort", "80 %s:%s" % (host, str(port)))
        ])
        svc_name = open(hidden_svc_dir + "/hostname", "r").read().strip()
        print("* Created host: ", svc_name)
    except Exception as e:
        print(e)
    app.run()
</pre>

<ul>
<li><code>stem.control</code>: Lets you interact with the Tor process via control port.</li>
<li><code>flask</code> : Python web framework. You can use some other light-weight framework of your choice.</li>
<li><code>render_template</code>: Lets you render HTML templates.</li>
</ul>

<pre class="brush:python">
controller = Controller.from_port(address="127.0.0.1", port=9151)
</pre>

<p>Connects to the Tor control port (usually <code>9051</code> or <code>9151</code> depending on your setup).</p>

<pre class="brush:python">
controller.set_options([
    ("HiddenServiceDir", hidden_svc_dir),
    ("HiddenServicePort", "80 127.0.0.1:5000")
])
</pre>

<p><img src="/images/hidden-service-directory.png" alt="Hidden Service Directory" /></p>

<p><code>HiddenServiceDir</code> is a path to the directory where Tor will store hidden service data like <code>hostname</code>, <code>private_key</code> etc. This code tells Tor to create a hidden service and store its config in <code>E:\web</code> folder. <code>HiddenServicePort</code> forwards incoming traffic on port <code>80</code> to flask application at <code>127.0.0.1:5000</code>.</p>

<pre class="brush:python">
svc_name = open(hidden_svc_dir + "/hostname", "r").read().strip()
print("* Created host: ", svc_name)
</pre>

<p>This reads the generated <code>.onion</code> address from the <code>hostname</code> file and prints it.</p>

<p>Just to make my first dark web page cool, I asked ChatGPT to render a cool looking HTML page. Copy this HTML page inside a <code>template</code> folder so it can be used with Flask.</p>

<p>Run the app</p>

<p><img src="/images/tor-web-app.png" alt="TOR Web App Start" /></p>

<p>For enhanced security and greater control, it’s advisable to use a dedicated web server configured with recommended best practices.</p>

<p>You will not be able to open the Tor browser on your system as the Tor service is already running and the browser will not be able to connect to the instance which is already running. Although, Tor browser can connect to the existing Tor service but this is not typical and is not recommended to use.</p>

<p>I am using a different machine to view my application using a Tor browser.</p>

<blockquote>
<p>Note that the loading of the page might be slow as it solely depends on the Tor network connectivity. It can take up to several minutes for the page to load.</p>
</blockquote>

<p><img src="/images/tor-web-app-running.png" alt="TOR Web App Start" /></p>

<p>The souce code along with the <code>torrc</code> file used above can be found in <a href="https://github.com/prashantkhandelwal/labcode/tree/main/tor-flask-app">this repo path</a>.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/conditional-compilation-in-rust-with-feature-flags/">Conditional Compilation in Rust with Feature Flags</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Nov 27, 2025
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/rust">RUST</a>
      
      
      
      
    </span>
    <div style="text-align: -webkit-center;">
<img src="/images/rust-feature-flag.png" alt="Rust feature flag" />
</div>

<p>I was checking out the <a href="https://openobserve.ai/">OpenObserve</a> — an open-source observability tool which you can self-host or use their cloud offering which offers free, standard and enterprise tier to choose from.</p>

<p>Written completely in rust so I thought of checking the codebase on <a href="https://github.com/openobserve/openobserve">Github</a> to get myself more aquatinted with rust language. While doing so I found a <code>#[cfg(feature = &quot;enterprise&quot;)]</code> being used in many places.</p>

<p>Looking at it, one can tell that any function or block decorated with this attribute is conditional, available only if the feature is enabled. But does this happen at compile time or runtime? If it’s compile time, the code will be compiled into the binary solely when the feature is turned on.</p>

<p>To test this and to gain more understanding on this, I created a rust application where I added <code>features</code> section in the <code>cargo.toml</code> file and added two features <code>opensource</code> and <code>enterprise</code> Kind of similar to the offering of OpenObserve. Here is my final <code>cargo.toml</code> file.</p>

<pre class="brush:text">
[package]
name = "cfgfeature"
version = "0.1.0"
edition = "2024"

[features]
community = []
enterprise = []
</pre>

<p>I updated my main.rs to this. I kept the <code>hello world</code> in the end.</p>

<pre class="brush:c">
fn main() {
   #[cfg(feature = "enterprise")]
   enterprise_feature();

   println!("Welcome to the app!");
}

#[cfg(feature = "enterprise")]
fn enterprise_feature() {
    println!("Enterprise feature activated!");
}
</pre>

<p>If I use just the <code>cargo run</code> command without specifying the <code>--features</code> flag, you will see the output <code>Welcome to the app</code>! which is expected. But the other function call like <code>enterprise_feature</code> was not even considered for execution. This is because of the <code>#cfg[(feature)]</code> attribute in Rust which is used to conditionally compile code only when the <code>enterprise</code> feature is enabled in the crate and passed as a parameter with the <code>--features</code> flag while building or running the program.</p>

<p>To make a binary which has the <code>enterprise</code> feature enabled, I can re-run the same command but this time, I will use <code>--features</code> flag.</p>

<pre class="brush:shell">
$ cargo run --features enterprise
</pre>

<p>Now you we can see the output from our <code>enterprise_feature</code> function as well.</p>

<pre class="brush:c">
$ cargo run --features enterprise
   Compiling cfgfeature v0.1.0 (F:\Code\rust\cfgfeature)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `target\debug\cfgfeature.exe`
Enterprise feature activated!
Welcome to the app!
</pre>

<p>When the <code>enterprise</code> feature is <strong>not enabled</strong>, any code marked with <code>#[cfg(feature = &quot;enterprise&quot;)]</code> is <strong>completely excluded</strong> from compilation. That means:</p>

<ul>
<li>The <code>enterprise_feature</code> function won’t be compiled.</li>
<li>It won’t exist in the final binary.</li>
<li>It won’t consume any space or resources.</li>
<li>You can’t call it unless the feature is enabled — doing so would result in a compile-time error.</li>
</ul>

<p>This is one of Rust’s powerful mechanisms for <strong>feature gating</strong>, allowing you to build modular, efficient binaries tailored to specific use cases or environments.</p>

<p>Let’s modify the above code a bit and look at some other ways of using this. Notice how I am marking a <code>println!</code> macro with <code>#[cfg(not(feature = &quot;enterprise&quot;))]</code> This will print the line<code>Enterprise features are not enabled</code> if I do not compile the code with <code>--features enterprise</code> flag. This line will not be printed if you pass the <code>--features enterprise</code> flag.</p>

<pre class="brush:c">
fn main() {
    println!("Welcome to the app!");

    #[cfg(feature = "enterprise")]
    enterprise_feature();

    #[cfg(not(feature = "enterprise"))]
    println!("Enterprise features are not enabled.");
}

#[cfg(feature = "enterprise")]
fn enterprise_feature() {
    println!("Enterprise feature is enabled!");
}
</pre>

<p>Running the above program with <code>cargo run</code> results in this output —</p>

<pre class="brush:shell">
$ cargo run
   Compiling cfgfeature v0.1.0 (F:\Code\rust\cfgfeature)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.34s
     Running `target\debug\cfgfeature.exe`
Welcome to the app!
Enterprise features are not enabled.
</pre>

<p>Here is a final example I would like to share. Consider the below code where I have two features <code>enterprise</code> and <code>community</code> and two functions <code>enterprise_feature</code> and <code>community_feature</code> marked with them respectively. But the main eye-catcher in code below are 3 different <code>main</code> functions.</p>

<pre class="brush:c">
#[cfg(feature = "enterprise")]
fn enterprise_feature() {
    println!("Enterprise feature activated!");
}

#[cfg(feature = "community")]
fn community_feature() {
    println!("Community feature activated!");
}

#[cfg(feature = "enterprise")]
fn main() {
    enterprise_feature();
}

#[cfg(feature = "community")]
fn main() {
    community_feature();
}

#[cfg(not(any(feature = "enterprise", feature = "community")))]
fn main() {
    println!("Not using enterprise or community feature.");
}
</pre>

<p>This code uses conditional compilation to define different <code>main</code> functions based on enabled feature flags:</p>

<ul>
<li>If the <code>enterprise</code> feature is enabled, the main function calls <code>enterprise_feature()</code>.</li>
<li>If the <code>community</code> feature is enabled, the main function calls <code>community_feature()</code>.</li>
<li>If neither <code>enterprise</code> nor <code>community</code> features are enabled—i.e., the program is built without the <code>--features</code> flag—the fallback <code>main</code> function runs, printing a default message.</li>
</ul>

<p>Here is the output of the above program if I try to run it without any feature flag —</p>

<pre class="brush:shell">
$ cargo run
   Compiling cfgfeature v0.1.0 (F:\Code\rust\cfgfeature)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.54s
     Running `target\debug\cfgfeature.exe`
Not using enterprise or community feature.
</pre>

<p>Output of the above program when I run it using the <code>--features enterprise</code> flag —</p>

<pre class="brush:shell">
$ cargo run --features enterprise
   Compiling cfgfeature v0.1.0 (F:\Code\rust\cfgfeature)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.35s
     Running `target\debug\cfgfeature.exe`
Enterprise feature activated!
</pre>

<p>Here are other logical combinations that you can use —</p>

<ul>
<li>Only if <code>enterprise</code> is enabled — <code>#[cfg(feature = &quot;enterprise&quot;)]</code></li>
<li>Only if both <code>enterprise</code> and <code>community</code> are enabled — <code>#[cfg(all(feature = &quot;enterprise&quot;, feature = &quot;community&quot;))]</code></li>
<li>Only if exactly one of them is enabled — <code>#[cfg(any(feature = &quot;enterprise&quot;, feature = &quot;community&quot;))]</code></li>
<li>Only if neither is enabled — <code>#[cfg(not(any(feature = &quot;enterprise&quot;, feature = &quot;community&quot;)))]</code></li>
</ul>

<p>You can also use this with <code>modules</code> and <code>crates</code> to conditionally compile them based on feature flags. Here is an example.</p>

<pre class="brush:c">
#[cfg(not(feature = "enterprise"))]
pub mod basic_features;

#[cfg(feature = "enterprise")]
pub mod enterprise_features;
</pre>

<p>This ensures that only one of the modules is compiled depending on the feature flag. You can also use it inside the module itself to conditionally compile functions or structs.</p>

<blockquote>
<p>You can conditionally include dependencies based on features.</p>
</blockquote>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/chatting-with-ollama-building-a-local-llm-web-app-in-minutes/">Chatting with Ollama: Building a Local LLM Web App in Minutes</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Nov 7, 2025
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/ai">AI</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/ollama">OLLAMA</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/svelte">SVELTE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/web">WEB</a>
      
      
      
      
    </span>
    <p><a href="https://ollama.com/">Ollama</a> is a lightweight and user-friendly way to run LLMs locally. No need for complex setups and it makes it super easy to explore AI chat models from the comfort of your own device.</p>

<p>This tutorial is a small part of a broader project I&rsquo;m working on, which involves using local LLMs and vision models to analyze data directly on-device. This approach helps reduce costs and addresses some of the privacy concerns raised by our customers.</p>

<p><strong>Installation and Setup</strong></p>

<p>Download and install Ollama from <a href="https://ollama.com/download">here</a>.</p>

<p>Once the setup is complete, simply launch the Ollama application—it will open a ChatGPT-like interface that lets you interact with local LLMs.</p>

<p><img src="/images/ollama-app.png" alt="Ollama App UI" /></p>

<p>This UI makes it very easy for searching, downloading and communicating with different LLMs. You can also chat with the models which are in the cloud without downloading them. Note that you require a Ollama account in order to communicate with a cloud model.</p>

<p>But we need to build a web based chat application and that means that we have to interact with Ollama API which is running at <code>https://localhost:11434</code></p>

<p><img src="/images/ollama-api-running.png" alt="Ollama API" /></p>

<p>Everyting seems to be set up properly. Let&rsquo;s create a Python FastAPI endpoint which allows us to communicate with Ollama API. You can also use NodeJS, Go or .NET WebAPI to create a service endpoint.</p>

<p>Create a Python virtual environment and install the below dependencies.</p>

<pre class="brush:shell">
pip install fastapi uvicorn requests httpx
</pre>

<p>The API uses a POST request and accepts three parameters: <code>prompt</code>, <code>model</code>, and <code>stream</code>.</p>

<ul>
<li><code>prompt</code> – The input message or query from the user.</li>
<li><code>model</code> – Specifies which model to run the prompt against. If not provided, it defaults to l<code>lama3.2:latest</code>.</li>
<li><code>stream</code> – Optional setting that defaults to <code>false</code>. Set it to <code>true</code> if you want the response to appear in a typing animation, similar to ChatGPT.</li>
</ul>

<blockquote>
<p>Note: enabling streaming requires additional changes to the code below. For below version of code, requests and httpx packages are not required.</p>
</blockquote>

<pre class="brush:python">
from fastapi import FastAPI
from pydantic import BaseModel
import requests

app = FastAPI()

class PromptRequest(BaseModel):
    prompt: str
    model: str = "llama3.2:latest"  # Default model, can be overridden in the request

@app.post("/generate")
async def generate_text(request: PromptRequest):
    ollama_api_url = "http://localhost:11434/api/generate"
    
    payload = {
        "model": request.model,
        "prompt": request.prompt,
        "stream": False # True for streaming responses
    }
    
    try:
        response = requests.post(ollama_api_url, json=payload)
        response.raise_for_status()  # Raise an exception for bad status codes
        
        # Extract the generated text from Ollama's response
        generated_text = response.json()["response"]
        return {"response": generated_text}
        
    except requests.exceptions.RequestException as e:
        return {"error": f"Error communicating with Ollama: {e}"}
</pre>

<p>Run this API using <code>uvicorn</code>.</p>

<pre class="brush:shell">
uvicorn main:app
</pre>

<p>The API server will start on default <code>8000</code> port. If you wish to change the port then start the API using the below command.</p>

<pre class="brush:shell">
uvicorn main:app --port 8080
</pre>

<p>Let&rsquo;s check the API response using Postman.</p>

<p><img src="/images/ollama-fastapi-postman.png" alt="Postman API Call" /></p>

<p>It’s quite helpful to see the response streamed in real time, just like how ChatGPT displays it. So let&rsquo;s change the <code>stream</code> parameter to <code>true</code> and update our API code.</p>

<pre class="brush:python highlight: [21]">
from fastapi import FastAPI
from fastapi.responses import StreamingResponse, HTMLResponse
from fastapi.staticfiles import StaticFiles
from pydantic import BaseModel
import httpx
import json
import os

app = FastAPI()

class PromptRequest(BaseModel):
    prompt: str
    model: str = "llama3.2:latest"

@app.post("/generate")
async def generate_text(request: PromptRequest):
    ollama_api_url = "http://localhost:11434/api/generate"
    payload = {
        "model": request.model,
        "prompt": request.prompt,
        "stream": True
    }

    async def stream_text():
        async with httpx.AsyncClient(timeout=None) as client:
            async with client.stream("POST", ollama_api_url, json=payload) as response:
                async for line in response.aiter_lines():
                    if line.strip():
                        try:
                            data = json.loads(line)
                            chunk = data.get("response", "")
                            if chunk:
                                yield chunk
                        except json.JSONDecodeError:
                            continue

    return StreamingResponse(stream_text(), media_type="text/plain")

</pre>

<p>Now we have a streaming response, let&rsquo;s make a UI, I am using Svelte. Start by creating a new project.</p>

<pre class="brush:shell">
npm create vite@latest ollama-chat -- --template svelte-ts
</pre>

<p>Update the <code>vite.config.ts</code> file to include a custom proxy setting for the development server. This setup ensures that any requests made to <code>/generate</code> are forwarded to <code>http://localhost:8000</code>, allowing the frontend to communicate seamlessly with a backend API like FastAPI. It also helps prevent CORS-related issues during development.</p>

<pre class="brush:js">
export default defineConfig({
  plugins: [svelte()],
   server: {
    proxy: {
      '/generate': 'http://localhost:8000'
    }
  }
})
</pre>

<p>The response is formatted in <code>Markdown</code>, so to render it correctly, you&rsquo;ll need an additional npm package called <code>marked</code>. You can install it using the command below.</p>

<pre class="brush:shell">
npm install marked
</pre>

<blockquote>
<p>Remember to change the port if your have setup the custom port for your API via uvicorn.</p>
</blockquote>

<p>Replace the code in <code>App.svelte</code> with the below code.</p>

<pre class="brush:jscript">
<script lang="ts">
  import { marked } from 'marked';

  let prompt: string = '';
  let chat: string = '';
  let chatHtml: string = '';
  let loading: boolean = false;

  async function sendPrompt(): Promise<void> {
    if (!prompt.trim()) return;
    chat = '';
    chatHtml = '';
    loading = true;

    const res = await fetch('/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt, model: 'llama3.2:latest' })
    });

    const reader = res.body?.getReader();
    const decoder = new TextDecoder('utf-8');

    if (reader) {
      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });
        chat += chunk;
        chatHtml = marked(chat); // Convert Markdown to HTML
      }
    }

    loading = false;
  }
</script>

<style>
  textarea {
    width: 100%;
    height: 100px;
    margin-bottom: 10px;
  }
  button {
    padding: 10px 20px;
  }
  #chat {
    margin-top: 20px;
    background: #243434;
    padding: 10px;
    border-radius: 5px;
    white-space: pre-wrap;
  }
  .chat-output {
    text-align: left;
  }
</style>

<h2>Ollama Chat</h2>
<label for="prompt">Enter your prompt:</label><br>
<textarea bind:value={prompt} id="prompt"></textarea><br>
<button on:click={sendPrompt} disabled={loading}>
  {loading ? 'Sending...' : 'Send'}
</button>

<div id="chat">
  {#if loading}
    <p>Loading...</p>
  {:else if chatHtml}
    <div class="chat-output">
      {@html chatHtml}
    </div>
  {:else}
    <p>No response yet.</p>
  {/if}
</div>
</style>

<h2>Ollama Chat</h2>
<label for="prompt">Enter your prompt:</label><br>
<textarea bind:value={prompt} id="prompt"></textarea><br>
<button on:click={sendPrompt} disabled={loading}>
  {loading ? 'Sending...' : 'Send'}
</button>

<div id="chat">{chat}</div>
</pre>

<p>Start the UI using this command.</p>

<pre class="brush:shell">
npm run dev
</pre>

<p>We are now all set to run our local LLM based chat agent. Let&rsquo;s start by asking a question.</p>

<p><img src="/images/ollama-chat-output.png" alt="Ollama web chat interface" /></p>

<p>This code serves as a starting point. You can extend it by adding image or file upload functionality, allowing users to summarize content or ask questions based on the data within the uploaded document or image.</p>

<p>Here is the <a href="https://github.com/prashantkhandelwal/ollama-chat">Github repo</a> where you can find the entire code.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/simple-and-cheap-create-a-diy-mouse-jiggler-with-raspberry-pi-pico/">Simple and Cheap: Create a DIY Mouse Jiggler with Raspberry Pi Pico</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Oct 31, 2024
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/iot">IOT</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/raspberry-pi">RASPBERRY PI</a>
      
      
      
      
    </span>
    

<p><img src="/images/mouse-jiggler.jpg#center" alt="A mouse jiggler" /></p>

<p>Today, my Amazon feed was flooded with mouse jiggler suggestions in various shapes, sizes, and features. A few days ago, during a chat with a friend, he mentioned wanting a device to keep his status active on Microsoft Teams while doing household chores. It was my first time hearing about such a gadget, and I found it fascinating to explore what it can do.</p>

<h3 id="what-is-a-mouse-jiggler"><strong>What is a Mouse Jiggler?</strong></h3>

<p>In a nutshell, mouse jiggler is a device which moves your mouse or simulate its movement to keep your computer active.</p>

<p>The cheapest mouse jiggler I can found on Amazon was around Rs. 880 or $11 (approx.). Now mouse and keyboard are Human Interface Device (HID) and this can be easily mimic with something like a cheap Raspberry PI Pico and the total cost of this will be around Rs. 330 or $4.00.</p>

<h3 id="how-to-build"><strong>How to build?</strong></h3>

<p>Grab a Raspberry PI Pico from <a href="https://robu.in">Robu.in</a> or <a href="https://thingbits.in">ThingBits.in</a> as these are the official reseller of Raspberry PIs in India.</p>

<h3 id="download-and-install-thonny"><strong>Download and Install Thonny</strong></h3>

<p><a href="https://thonny.org/">Thonny</a> is a Python IDE which has excellent support for Raspberry PI. I will be using this IDE so the steps are more clear to anyone who is working with a RPI for the first time.</p>

<h3 id="configuring-the-ide"><strong>Configuring the IDE</strong></h3>

<p>After the installation is complete, plug the Pico to your computer while holding the BOOTSEL button on the PICO. This will put the PICO in the <code>bootloader</code> mode.</p>

<p>Click the bottom right corner of the main window, and select <code>Configure interpreter</code>.</p>

<p><img src="/images/thonny-change-interpreter.png" alt="Change Interpreter" /></p>

<p>Thonny options window will pop up where you will now click <code>Install or update CircuitPython(UF2)</code>.</p>

<p><img src="/images/thonny-options.png" alt="Thonny Options" /></p>

<p><img src="/images/thonny-install-ciruitpython.png" alt="Thonny installing CircuitPython" /></p>

<p>Click <code>Install</code> to start the installation and wait for it to finish. The device will restart after the installation is completed.</p>

<h3 id="install-dependencies"><strong>Install dependencies</strong></h3>

<p>We need Adafruit&rsquo;s HID library which you can download from <a href="https://circuitpython.org/libraries">here</a>. Extract the contents of the zip file and copy <code>adafruit_hid</code> folder to the <code>lib</code> folder which is at the root of the Pico.</p>

<h3 id="code-code-code"><strong>Code Code Code</strong></h3>

<p>If you are using Thonny then open <code>code.py</code> file by pressing <code>CTRL + O</code> and paste in the following code.</p>

<p><img src="/images/thonny-file-open.png" alt="Thonny file open" /></p>

<blockquote>
<p>NOTE: You will not see this dialog box if you have a wrong backend or no backend selected. You can change or select the right backend from the bottom right corner of of the Thonny IDE.</p>
</blockquote>

<pre class="brush:python">
import usb_hid
from adafruit_hid.mouse import Mouse
from time import sleep

m = Mouse(usb_hid.devices)

while True:
       m.move(-5, 0, 0)
       sleep(0.5)
       m.move(5, 0, 0)
       sleep(0.5)
</pre>

<p>The line from <code>adafruit_hid.mouse import Mouse</code> imports the Mouse dependency, allowing us to control the mouse programmatically. The code is straightforward and can be tailored to your specific needs. In my case, I want to move the mouse slightly to keep my status active while I&rsquo;m away. You can increase the time interval beyond <code>0.5</code> seconds, as both Teams and Slack take a while to detect inactivity before marking your status as inactive.</p>

<p>Currently, this Raspberry Pi Pico-based Mouse Jiggler is a fixture on my other always-on machine, saving me from having to re-login whenever I forget to move the mouse while deep in work.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/setting-up-virtuanes-emulator-for-retro-gaming-on-windows/">Setting Up VirtuaNES Emulator For Retro Gaming On Windows</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Jun 19, 2023
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/emulator">EMULATOR</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/gaming">GAMING</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/windows">WINDOWS</a>
      
      
      
      
    </span>
    

<p>I grew up playing all the 90s games and I still love them. For quite a sometime I am now using VirtuaNES emulator to do retro gaming on my Windows machine. There are other NES emulators out there but this is the one I have been using now for a while and it has been good so far.</p>

<p>To setup VirtuaNES emulator on Windows, download it from <a href="https://www.emulatorgames.net/emulators/nintendo/virtualnes-0-9-7/">here</a> and <a href="https://www.emulator-zone.com/doc.php/nes/virtuanes.html">here</a>. Once you download the zip file, extract the content to any folder and double click the <code>VirtuaNES.exe</code> to run the emulator.</p>

<p><img src="/images/virtuanes-extract-folder.png" alt="VirtuaNES files after extraction" /></p>

<p>After the emulator is launched, we can start configuring the sound and controller. If you are a keyboard person, then no configuration is needed, you can instantly load a ROM and start playing the game. The default keys are as follows (yours might look a little different):</p>

<p>Go to <strong>Options -&gt; Controller</strong> to change the keyboard bindings or your controller bindings.</p>

<p><img src="/images/virtuanes-keyboard-maps.png" alt="VirtuaNES keyboard settings" /></p>

<blockquote>
<p>XBOX One controller is also compatible and you can configure it easily. Make sure to turn on or plug in the controller before you start the emulator.</p>
</blockquote>

<p>Here is the screenshot of the bindings of my XBox One controller.</p>

<p><img src="/images/virtuanes-xbox-bindings.png" alt="VirtuaNES xbox controller bindings" /></p>

<p>For configuring the sound settings, go to <strong>Options -&gt; Sound</strong></p>

<p><img src="/images/virtuanes-sound-settings.png" alt="VirtuaNES sound settings" /></p>

<p>Even after setting up the sound, there is a chance that you can&rsquo;t hear it when you play the game. That is due to a setting in the audio settings section in Windows. Refer the below screenshot and check whether the <code>Mono audio</code> is <code>off</code> or <code>on</code>. If it is <code>off</code>, then you have to turn it <code>on</code> and that will solve the sound problem in the emulator.</p>

<p><img src="/images/virtuanes-system-sound-settings.png" alt="VirtuaNES system sound settings" /></p>

<p>All set now!! Let&rsquo;s get some games or ROMs as we call it and load it in the emulator. I downloaded few ROMs from <a href="https://www.emulatorgames.net/roms/nintendo/">Emulatorgames.net</a>. Extract the zip file and load the ROM in the emulator by going to <strong>File -&gt; Open</strong>. You should now see your childhood retro gaming console in front of you.</p>

<p><img src="/images/virtuanes-emulator-running.png" alt="VirtuaNES emulator running" /></p>

<h3 id="links">Links</h3>

<ul>
<li><a href="https://www.emulatorgames.net/">Emulator Games</a></li>
<li><a href="https://www.emulatorgames.net/roms/">ROMs for all platform emulators</a></li>
<li><a href="https://www.emulatorgames.net/emulators/">Other emulators</a></li>
</ul>

  </div>
  
</div>


<ul class="pagination">
    
    <li class="page-item">
        <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item disabled">
    <a href="" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/34/">34</a></li>
    
    
    <li class="page-item">
    <a href="/page/2/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/page/34/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


        </div>
        



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-QYXJT2TJCG', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css"
  rel="stylesheet"
/>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCss.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushSql.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPowerShell.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushRuby.min.js"
></script>

<script>
  SyntaxHighlighter.defaults["gutter"] = true;
  SyntaxHighlighter.defaults["smart-tabs"] = true;
  SyntaxHighlighter.defaults["auto-links"] = true;
  SyntaxHighlighter.defaults["collapse"] = false;
  SyntaxHighlighter.defaults["light"] = false;
  SyntaxHighlighter.defaults["tab-size"] = 4;
  SyntaxHighlighter.defaults["toolbar"] = false;
  SyntaxHighlighter.defaults["wrap-lines"] = true;
  SyntaxHighlighter.all();
</script>


    </body>
</html>
