<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.49" />

    
    
    

<title>Visualizing ADXL345 Accelerometer Output In Windows Forms From Raspberry PI 2 â€¢ Midnight Programmer</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Visualizing ADXL345 Accelerometer Output In Windows Forms From Raspberry PI 2"/>
<meta name="twitter:description" content="I have been playing a lot with Raspberry PI and Python these days and have also started a side project to create robot car controller with a Xbox 360 wireless controller. I am planning to controller a robot car using a custom interface from my Windows machine. Initially I tried with PyQt but I dropped the idea for now as Python is not my primary expertise and it will take some time for me to learn the basics and get into some serious coding."/>

<meta property="og:title" content="Visualizing ADXL345 Accelerometer Output In Windows Forms From Raspberry PI 2" />
<meta property="og:description" content="I have been playing a lot with Raspberry PI and Python these days and have also started a side project to create robot car controller with a Xbox 360 wireless controller. I am planning to controller a robot car using a custom interface from my Windows machine. Initially I tried with PyQt but I dropped the idea for now as Python is not my primary expertise and it will take some time for me to learn the basics and get into some serious coding." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://prashantkhandelwal.github.io/post/visualizing-adxl345-accelerometer-output-in-windows-forms-from-raspberry-pi-2/" /><meta property="article:published_time" content="2016-09-26T21:21:00&#43;00:00"/>
<meta property="article:modified_time" content="2016-09-26T21:21:00&#43;00:00"/><meta property="og:site_name" content="Midnight Programmer" />


    


<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.css" media="print">


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://prashantkhandelwal.github.io/">Midnight Programmer</a>
      </span>
      
      
      
      <div class="author-image">
        <img src="https://prashantkhandelwal.github.io//img/prashantk.jpg" alt="Author Image" class="img--circle img--headshot element--center"> 
      </div>
      
      <p class="site__description">
         Programming For Fun 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Midnight Programmer</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/archive/"><i class='fa fa-road'></i>
						<span>Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/top-posts/"><i class='fa fa-star fa-fw'></i>
						<span>Top Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/contact/"><i class='fa fa-envelope fa-fw'></i>
						<span>Contact</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	<a href="https://facebook.com/khandelwal.p" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/prashantkhandelwal" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="http://feeds.feedburner.com/MidnightProgrammer" rel="me"><i class="fa fa-rss fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://instagram.com/prashantkhandelwal" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/khandelwalprashant" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy; 2019 Pashant Khandelwal
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/in/"><img style="border-width: 0;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/in/88x31.png" alt="Creative Commons License" class="thinglinkFiltered"></a>
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1 class="item__title--big">Visualizing ADXL345 Accelerometer Output In Windows Forms From Raspberry PI 2</h1>
    
    
<div class="post__meta">
    
    
    <span>
        <i class="fas fa-calendar-alt"></i> Sep 26, 2016
    </span>
    
    
    
    
    
    
    
    
    <a class="badge badge-category" href="/category/c">C#</a>
    &nbsp;
    
    <a class="badge badge-category" href="/category/raspberry-pi">RASPBERRY PI</a>
    &nbsp;
    
    <a class="badge badge-category" href="/category/windows">WINDOWS</a>
    
    
    
    
    
    
    <br />
    
</div>

  </header>
  
  
  <div class="post">
    

<p>I have been playing a lot with Raspberry PI and Python these days and have also started a side project to create robot car controller with a Xbox 360 wireless controller. I am planning to controller a robot car using a custom interface from my Windows machine. Initially I tried with <a href="https://riverbankcomputing.com/software/pyqt/intro">PyQt</a> but I dropped the idea for now as Python is not my primary expertise and it will take some time for me to learn the basics and get into some serious coding. Controlling something remotely or visualizing the information from your device on the UI is always better. For a proof of concept I built a Windows Forms application which will request the output from Raspberry PI over TCP and then visualize it on the UI using a wonderful chart library that I found today. There is a slight change in the Python code as I have to transmit readings from Raspberry PI over TCP so my Windows Forms application can read the output and utilize it to visualize it.</p>

<p><img src="/images/azure-iot-raspberry.png" alt="RaspberryPi Azure IoT Diagram" /></p>

<h4 id="raspberry-pi-python-application">Raspberry PI Python Application</h4>

<p>Reading the <a href="https://www.sparkfun.com/products/9836">ADXL345</a> output is fairly simple and you can do this without any problem by using Adafruit&rsquo;s <a href="https://github.com/adafruit/Adafruit_Python_ADXL345">ADXL345 Python library</a>. This library will get you started in a jiffy and you will have your readings. I am not going into the details about the different features of the library I am using and ADXL345. The only thing you will have to do is to wire ADXL345 to your Raspberry PI and fire the example code you got from Adafruit&rsquo;s repository from Github. If you have set it up correctly this, you will see X, Y, Z values on your terminal. If the terminal displays <code>0s</code> for all the three axis then there is something wrong with the wiring (assuming you are using the example code). This is how your writing should be like.</p>

<p><img src="/images/raspberrypi-fritz-sketch.png" alt="Raspberry Pi Fritzing Sketch" /></p>

<p>Now I have made slight changes in the code so that I can send the data over TCP. I have created a simple TCP server which exposes Raspberry PI through IP address and a port number. This is the complete code for reading values from ADXL345.</p>

<pre class="brush: python">
import Adafruit_ADXL345
import socket
 
HOST = "192.168.1.8"
PORT = 50007
 
accel = Adafruit_ADXL345.ADXL345()
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(1)
conn, addr = s.accept()
 
while 1:
    data = conn.recv(1024)
 
    if data.strip() == "adxl":
        x, y, z = accel.read()
        data = 'X:' + str(x) + '|Y:' + str(y) + '|Z:' + str(z)
        conn.send(data)
</pre>

<p>In the code, you can see that I am not just transmitting the readings just like that. I only transmit when there is a request from another application is there to get the readings. This is a good approach as I don&rsquo;t the PI to transmit the readings even if nobody is requesting it. I am sending a single string as a response which I am going to read at my Windows Forms application and use it.</p>

<blockquote>
<p>You need to change the IP address and port number according to your Pi&rsquo;s configuration.</p>
</blockquote>

<p>Once this is done you can then execute the script from the terminal by firing the below command</p>

<pre class="brush: bash">
sudo python adxl.py
</pre>

<p>This is it from Raspberry PI side. Let&rsquo;s take a look from the Windows side now.</p>

<h4 id="windows-forms-application">Windows Forms Application</h4>

<p>This will be a simple Windows Forms application which will connect to the Raspberry PI using the Pi&rsquo;s IP address and the port on which the server is running. The Windows Form application is also a TCP client which sends a request to Raspberry PI for the updated readings from ADXL345. As I mentioned above in the Python code that the readings are not just being transmitted but a client has to send a request to to get the readings.</p>

<p>Let&rsquo;s get started with the visualizing part. While was searching for a perfect charting library, I came across this wonderful library called <a href="https://lvcharts.net/">Live Charts</a>. This library is open-source, easy to use, has lots of awesome charts and a <a href="https://lvcharts.net/App/examples/wpf/start">very robust documentation</a> and moreover it supports Windows Forms as well as on WPF applications. I highly recommend you to look at the examples to get the idea about this library.</p>

<p>As usual, I will be using Nuget command to install the library.</p>

<pre class="brush: plain">
PM> Install-Package LiveCharts.WinForms
</pre>

<p>You also have to add the custom controls in the toolbox. You can follow the steps here to add the Live Charts control in the toolbox. In the design mode, choose the <code>Cartesian Chart</code> control from the toolbox and add it to the form. After adding the control to the form, I have dock it to the top of the form so I can utilize the lower section of the form to display the readings in numbers. Here is how my form looks like in design mode.</p>

<p><img src="/images/winform-design-view.png" alt="Windows Forms design view" /></p>

<p>After the designing for the form is complete, I can initialize the chart to display the readings from Raspberry PI. The chart require few things to be setup before it can start displaying the data correctly. The accelerometer I am using is a 3-axis accelerometer and therefore it is going to send me readings for 3 axis i.e X, Y and Z. This means I will be needing 3 line series to visualize the information from accelerometer. To have 3 line series display the data I have to use <code>CharValues</code> class which will let me display the readings in the line series. As I have to update my chart when I request the new readings from Raspberry PI, I have to use <code>ObservableValue</code> type. The <code>ObservableValue</code> will make sure that whenever there is a change in the value, it gets reflected in the chart and therefore keeping the chart always up to date.</p>

<pre class="brush: csharp">
public ChartValues&lt;ObservableValue&gt; Values_X { get; set; }
public ChartValues&lt;ObservableValue&gt; Values_Y { get; set; }
public ChartValues&lt;ObservableValue&gt; Values_Z { get; set; }
</pre>

<p>Because I am going to make request to the server running on my Raspberry PI and request for the ADXL345 readings, I have to create a TCP client in order to do so.</p>

<pre class="brush: csharp">
Socket server;
IPEndPoint ipEndPoint;
byte[] data;
</pre>

<p>When the application is loaded, I want to make connection to Raspberry PI by using it&rsquo;s IP address and port number on which the server is running on. To do this I will add the below code to the constructor of my application.</p>

<pre class="brush: csharp">
 
ipEndPoint = new IPEndPoint(
                IPAddress.Parse("192.168.1.8"), 50007);
 
server = new Socket(AddressFamily.InterNetwork,
               SocketType.Stream, ProtocolType.Tcp);
 
try
{
    server.Connect(ipEndPoint);
}
catch (SocketException)
{
    MessageBox.Show("Unable to connect to server.", "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
    return;
}
</pre>

<p>The above code is self-explanatory as I am just connecting to Raspberry PI.</p>

<p>In the form load event, I have to initialize chart values and add 3 line series to my <code>CartesianChart</code> for X, Y and Z axis respectively. In my case the name of the Cartesian Chart is <code>ADXLViz</code>.</p>

<pre class="brush: csharp">
Values_X = new ChartValues&lt;ObservableValue&gt;();
Values_Y = new ChartValues&lt;ObservableValue&gt;();
Values_Z = new ChartValues&lt;ObservableValue&gt;();
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_X,
    Title = "X",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_Y,
    Title = "Y",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_Z,
    Title = "Z",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
</pre>

<p>Play around with different properties in the <code>LineSeries</code> class and set the output that suits your need or your eye. Notice the Values properties in the <code>LineSeries</code> class which holds the value which is received from Raspberry PI.</p>

<p>I am requesting the readings from Raspberry PI every 500ms and to do this I am using a <code>Timer</code> class. This is easy to use and configure. Just drag and drop the <code>Timer</code> control from the toolbox. In the properties change the <code>Interval</code> property to <code>500</code> and <code>Enabled</code> to <code>True</code>. After this I set the <code>Tick</code> event which will request the new readings every 500ms.</p>

<pre class="brush: csharp">
string stringData;
server.Send(Encoding.ASCII.GetBytes("adxl"));
data = new byte[1024];
int recv = server.Receive(data);
stringData = Encoding.ASCII.GetString(data, 0, recv);
string[] adxl = stringData.Replace(" ", "").Split('|');
 
Values_X.Add(new ObservableValue(Convert.ToDouble(adxl[0].Split(':')[1])));
Values_Y.Add(new ObservableValue(Convert.ToDouble(adxl[1].Split(':')[1])));
Values_Z.Add(new ObservableValue(Convert.ToDouble(adxl[2].Split(':')[1])));
 
if (Values_X.Count &gt; 10) Values_X.RemoveAt(0);
if (Values_Y.Count &gt; 10) Values_Y.RemoveAt(0);
if (Values_Z.Count &gt; 10) Values_Z.RemoveAt(0);
 
X_Label.Text = Convert.ToString(adxl[0].Split(':')[1]);
Y_Label.Text = Convert.ToString(adxl[1].Split(':')[1]);
Z_Label.Text = Convert.ToString(adxl[2].Split(':')[1]);
</pre>

<p>The <code>stringData</code> variable holds the response or reading which is received from Raspberry PI. If you check the Python code above you will see that the response is being sent in a single string called <code>data</code>. I am splitting the string here and extracting the values and setting it to <code>ChartValues&lt;ObservableValue&gt;</code> object. This will render all the 3 line series chart and update it with the readings received from PI. But the problem here will be that in few minutes the chart will be hard to see due to lot of data congestion in chart. In order to overcome this problem, I have removed the first value from all the 3 line series when the chart displays more than 10 values. You can change the value from 10 to whatever suits you.</p>

<p><img src="/images/adxl345-viz-winform.png" alt="ADXL345 application output" /></p>

<p>The overall idea of building this application is to see whether it is possible or easy to communicate from Raspberry PI apart from using frameworks like <a href="http://webiopi.trouch.com/">WebioPI</a> or <a href="http://flask.pocoo.org/">Flask</a>. The complete source code for Raspberry PI and Windows Forms application is <a href="https://github.com/prashantkhandelwal/Pi-Code/tree/master/ADXL345%20Visualizer">available on Github</a> along with Fritzing sketch file and additional instructions to install the dependencies.</p>

  </div>
  <div style="text-align:center; margin-top:10px">
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5924643983709476",
        enable_page_level_ads: true
      });
    </script>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/post/building-angular-2-app-with-web-api-and-net-core/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Building Angular 2 App With Web API And .NET Core</span>
    </a>
    
    
    <a href="/post/get-the-correct-file-paths-in-net-core/" class="navigation-next">
      <span class="navigation-tittle">Get The Correct File Paths In .NET Core</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        

<div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'midnightprogrammer';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>
 




        </div>
        
    
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-8994557-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css" rel="stylesheet">

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCss.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushSql.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPowerShell.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"></script>

<script>
    SyntaxHighlighter.defaults['gutter'] = true;
    SyntaxHighlighter.defaults['smart-tabs'] = true;
    SyntaxHighlighter.defaults['auto-links'] = true;
    SyntaxHighlighter.defaults['collapse'] = false;
    SyntaxHighlighter.defaults['light'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 4;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true;
    SyntaxHighlighter.all();
</script>



    



    </body>
</html>
