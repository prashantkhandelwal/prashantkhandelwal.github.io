<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.49" />

    
    
    

<title>Capture screenshot and description of a web page using Go and Chromedp â€¢ Midnight Programmer</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Capture screenshot and description of a web page using Go and Chromedp"/>
<meta name="twitter:description" content="Adding or sharing a link with a snapshot of a web page is a very useful feature in Microsoft Teams or in Zoom chat. This gives a user a way to quickly look at the web page snapshot and a small description about the link.
Go has an amazing library called chromedp which allows you to perform some amazing tasks like taking screenshot, fill out a form and submit it, send key events, device emulation, script evaluation etc."/>

<meta property="og:title" content="Capture screenshot and description of a web page using Go and Chromedp" />
<meta property="og:description" content="Adding or sharing a link with a snapshot of a web page is a very useful feature in Microsoft Teams or in Zoom chat. This gives a user a way to quickly look at the web page snapshot and a small description about the link.
Go has an amazing library called chromedp which allows you to perform some amazing tasks like taking screenshot, fill out a form and submit it, send key events, device emulation, script evaluation etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://prashantkhandelwal.github.io/post/capture-screenshot-and-description-of-a-web-page-using-go-and-chromedp/" /><meta property="article:published_time" content="2023-04-05T12:13:00&#43;00:00"/>
<meta property="article:modified_time" content="2023-04-05T12:13:00&#43;00:00"/><meta property="og:site_name" content="Midnight Programmer" />


    


<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.css" media="print">


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://prashantkhandelwal.github.io/">Midnight Programmer</a>
      </span>
      
      
      
      <div class="author-image">
        <img src="https://prashantkhandelwal.github.io//img/prashantk.jpg" alt="Author Image" class="img--circle img--headshot element--center"> 
      </div>
      
      <p class="site__description">
         Programming For Fun 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Midnight Programmer</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/archive/"><i class='fa fa-road'></i>
						<span>Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/top-posts/"><i class='fa fa-star fa-fw'></i>
						<span>Top Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/contact/"><i class='fa fa-envelope fa-fw'></i>
						<span>Contact</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	<a href="https://facebook.com/khandelwal.p" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/prashantkhandelwal" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="http://feeds.feedburner.com/MidnightProgrammer" rel="me"><i class="fa fa-rss fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://instagram.com/prashantkhandelwal" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/khandelwalprashant" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://medium.com/@prashantkhandelwal" rel="me"><i class="fab fa-medium fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy; 2023 Pashant Khandelwal
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/in/"><img style="border-width: 0;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/in/88x31.png" alt="Creative Commons License" class="thinglinkFiltered"></a>
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1 class="item__title--big">Capture screenshot and description of a web page using Go and Chromedp</h1>
    
    
<div class="post__meta">
    
    
    <span>
        <i class="fas fa-calendar-alt"></i> Apr 5, 2023
    </span>
    
    
    
    
    
    
    
    
    <a class="badge badge-category" href="/category/chromedp">CHROMEDP</a>
    &nbsp;
    
    <a class="badge badge-category" href="/category/go">GO</a>
    &nbsp;
    
    <a class="badge badge-category" href="/category/web">WEB</a>
    
    
    
    
    
    
    <br />
    
</div>

  </header>
  
  
  <div class="post">
    <p>Adding or sharing a link with a snapshot of a web page is a very useful feature in Microsoft Teams or in Zoom chat. This gives a user a way to quickly look at the web page snapshot and a small description about the link.</p>

<p>Go has an amazing library called <a href="https://github.com/chromedp/chromedp">chromedp</a> which allows you to perform some amazing tasks like taking screenshot, fill out a form and submit it, send key events, device emulation, script evaluation etc. You can look at the complete example list <a href="https://github.com/chromedp/examples">here</a>.</p>

<p>We are interested in taking a screenshot of the web page for the given URL. Chromedp allows you the take a screenshot of a specific element of the page or for the entire browser viewport.</p>

<p>The use case I am having is to capture just enough of the web page to give an idea to the user about the website. Looking at the screenshot and recalling whether one has visited this link or not is easier than looking at the link. Here is a sample code which will let you snap a screenshot of a given web page.</p>

<pre class="brush:ruby">
package main

import (
 "context"
 "crypto/rand"
 "fmt"
 "log"
 "os"
 "time"
 "unsafe"

 "github.com/chromedp/cdproto/emulation"
 "github.com/chromedp/chromedp"
)

const (
 UserAgentName = "Websnapv1.0"
 Path          = "images\\"
 Timeout       = 15
)

// https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-go
func GenRandStr(n int) string {
 var alphabet = []byte("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")
 b := make([]byte, n)
 rand.Read(b)
 for i := 0; i < n; i++ {
  b[i] = alphabet[b[i]%byte(len(alphabet))]
 }
 return *(*string)(unsafe.Pointer(&b))
}

func Snap(url string) (string, error) {
 ctx, cancel := chromedp.NewContext(context.Background())
 defer cancel()

 // Creating timeout for 15 seconds
 ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
 defer cancel()

 name := GenRandStr(12)
 var buf []byte
 var file = Path + name + ".png"

 err := chromedp.Run(ctx,
  emulation.SetUserAgentOverride(UserAgentName),
  chromedp.Navigate(url),
  //chromedp.FullScreenshot(&buf, 100),
  chromedp.CaptureScreenshot(&buf),
 )

 if err != nil {
  log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
  return "", err
 }

 if err := os.WriteFile(file, buf, 0o644); err != nil {
  log.Fatalf("ERROR:webext - Cannot create snap for the link - %s\n", url)
  file = ""
  return "", err
 }

 return file, nil
}

func main() {
 i, err := Snap("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
 if err != nil {
  log.Fatalf("ERROR: Unable to retrieve screenshot - %v", err.Error())
 }

 // print the image path
 fmt.Println(i)
}
</pre>

<p>Here, I have some <code>const</code> declared which are easy to understand. Then I have a random string generator which I found on Stackoverflow to generate random image names. In the end I have a function <code>snap</code> which takes a screenshot of the web page. Overall, this function is very simple to understand but I want you to pay special attention to this part of the function where <code>chromedp</code> is used.</p>

<pre class="brush:ruby">
err := chromedp.Run(ctx, 
  emulation.SetUserAgentOverride("Bindv1.0"), 
  chromedp.Navigate(url), 
  chromedp.CaptureScreenshot(&buf), 
 ) 
</pre>

<p>Now the <code>CaptureScreenshot</code> is a function which will capture a part of the web page. This function accepts the pointer to the buffer to which it writes the output eventually writes to an image file. Here is an example output:</p>

<p><img src="/images/screenshot-web-page-1.png" alt="Screenshot from `CaptureScreenshot` function" /></p>

<p>The next useful function that you can also use is called <code>FullScreenshot</code>. This function will let you capture the entire web page as an image. You can use this function with your functional tests to check how your web page looks when accessed from a different location or with different parameters. This function takes two parameters, the first is the pointer to the buffer, just like the one before and the second one is the <code>quality</code> of the image. As the screenshot is for the entire viewport or the web page, I am uploading an image displayed in an image viewer program to give you a perspective of the screenshot. Here is an example output:</p>

<p><img src="/images/Screenshot-full-viewport.png" alt="Screenshot from `FullScreenshot` function" /></p>

<p>With screenshots done, letâ€™s also get some basic information about the web page as well. Letâ€™s create a new method and name it <code>ExtractMeta</code>. It accepts URL of the web page as a parameter and returns a pointer to the <code>WebData</code> struct which holds value for <code>Title</code> and <code>Description</code> of the web page. This function looks exactly like the <code>Snap</code> function except for a slight change in the Run function usage and some variable declarations to hold returned values. Here is the code for extracting the metadata information:</p>

<pre class="brush:ruby">
var pageTitle, description string

var w = &WebData{}

err := chromedp.Run(ctx,
 emulation.SetUserAgentOverride(UserAgentName),
 chromedp.Navigate(url),
 chromedp.Title(&pageTitle),
 chromedp.Evaluate(`document.querySelector("meta[name^='description' i]").getAttribute('content');`, &description),
)

w.Title = pageTitle
w.Description = description
</pre>

<p>Notice that the <code>Run</code> function has additional parameters <code>chromedp.Evaluate</code> and <code>chromedp.Title</code>. The <code>chromedp.Title</code> returns the title of the web page. The <code>chromedp.Evaluate</code> function lets you evaluate or execute a <code>JavaScript</code> on the web page it is visiting and return the result so you can use it. For our use case, which is to get the description of the web page, we can execute the <code>document.querySelector</code> on the <code>meta</code> tags of the web page where the meta tag <code>name</code> equals to <code>description</code>. The <code>i</code> is the case-insensitivity qualifier here. Add the below code to the <code>main</code> function:</p>

<pre class="brush:ruby">
w, err := ExtractMeta("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
if err != nil {
 log.Fatalf("ERROR: Unable to retrieve metadata - %v", err.Error())
}
fmt.Println(w.Title)
fmt.Println(w.Description)
</pre>

<p>Executing above code will generate the output like this:</p>

<p><img src="/images/final-output.png" alt="Final output of the entire program" /></p>

<p>Similarly, you can also execute this function multiple times to get other information from the web page as desired.</p>

<p>Here is the complete code for reference:</p>

<pre class="brush:ruby">
package main

import (
    "context"
    "crypto/rand"
    "fmt"
    "log"
    "os"
    "time"
    "unsafe"

    "github.com/chromedp/cdproto/emulation"
    "github.com/chromedp/chromedp"
)

const (
    UserAgentName = "Websnapv1.0"
    Path          = "images\\"
    Timeout       = 15
)

type WebData struct {
    Title       string
    Description string
}

// https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-go
func GenRandStr(n int) string {
    var alphabet = []byte("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")
    b := make([]byte, n)
    rand.Read(b)
    for i := 0; i < n; i++ {
        b[i] = alphabet[b[i]%byte(len(alphabet))]
    }
    return *(*string)(unsafe.Pointer(&b))
}

func Snap(url string) (string, error) {
    ctx, cancel := chromedp.NewContext(context.Background())
    defer cancel()

    // Creating timeout for 15 seconds
    ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
    defer cancel()

    name := GenRandStr(12)
    var buf []byte
    var file = Path + name + ".png"

    err := chromedp.Run(ctx,
        emulation.SetUserAgentOverride(UserAgentName),
        chromedp.Navigate(url),
        //chromedp.FullScreenshot(&buf, 100),
        chromedp.CaptureScreenshot(&buf),
    )

    if err != nil {
        log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
        return "", err
    }

    if err := os.WriteFile(file, buf, 0o644); err != nil {
        log.Fatalf("ERROR:webext - Cannot create snap for the link - %s\n", url)
        file = ""
        return "", err
    }

    return file, nil
}

func ExtractMeta(url string) (*WebData, error) {
    ctx, cancel := chromedp.NewContext(context.Background())
    defer cancel()

    // Creating timeout for 15 seconds
    ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
    defer cancel()

    var pageTitle, description string

    var w = &WebData{}

    err := chromedp.Run(ctx,
        emulation.SetUserAgentOverride(UserAgentName),
        chromedp.Navigate(url),
        chromedp.Title(&pageTitle),
        chromedp.Evaluate(`document.querySelector("meta[name^='description' i]").getAttribute('content');`, &description),
    )

    if err != nil {
        log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
        return nil, err
    }

    w.Title = pageTitle
    w.Description = description

    return w, nil
}

func main() {
    i, err := Snap("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
    if err != nil {
        log.Fatalf("ERROR: Unable to retrieve screenshot - %v", err.Error())
    }

    // print the image path
    fmt.Println(i)

    // Extract metadata of the page
    w, err := ExtractMeta("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
    if err != nil {
        log.Fatalf("ERROR: Unable to retrieve metadata - %v", err.Error())
    }
    fmt.Println(w.Title)
    fmt.Println(w.Description)
}
</pre>

<p><strong>References</strong></p>

<ul>
<li><a href="https://github.com/chromedp/chromedp">Chromedp GitHub Repository</a></li>
<li><a href="https://github.com/chromedp/examples">Chromedp Examples GitHub Repository</a></li>
</ul>

  </div>
  <div style="text-align:center; margin-top:10px">
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-5924643983709476",
        enable_page_level_ads: true
      });
    </script>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/post/marvel-comics-universe-graph-db/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Marvel Comics Universe Graph Database</span>
    </a>
    
    
    <a href="/post/how-to-host-your-react-application-for-cheap-with-azure-blob-storage/" class="navigation-next">
      <span class="navigation-tittle">How To Host Your React Application For Cheap With Azure Blob Storage</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        

<div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'localblog-3';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>
 




        </div>
        
    
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-8994557-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css"
  rel="stylesheet"
/>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCss.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushSql.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPowerShell.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushRuby.min.js"
></script>

<script>
  SyntaxHighlighter.defaults["gutter"] = true;
  SyntaxHighlighter.defaults["smart-tabs"] = true;
  SyntaxHighlighter.defaults["auto-links"] = true;
  SyntaxHighlighter.defaults["collapse"] = false;
  SyntaxHighlighter.defaults["light"] = false;
  SyntaxHighlighter.defaults["tab-size"] = 4;
  SyntaxHighlighter.defaults["toolbar"] = false;
  SyntaxHighlighter.defaults["wrap-lines"] = true;
  SyntaxHighlighter.all();
</script>



    



    </body>
</html>
