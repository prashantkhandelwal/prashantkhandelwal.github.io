<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.49" />

    

<title>Midnight Programmer</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Midnight Programmer"/>
<meta name="twitter:description" content="Programming For Fun"/>

<meta property="og:title" content="Midnight Programmer" />
<meta property="og:description" content="Programming For Fun" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://prashantkhandelwal.github.io/" />
<meta property="og:updated_time" content="2023-04-05T12:13:00&#43;00:00"/><meta property="og:site_name" content="Midnight Programmer" />


    


<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.css" media="print">


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

<link href="https://prashantkhandelwal.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Midnight Programmer" />
<link href="https://prashantkhandelwal.github.io/index.xml" rel="feed" type="application/rss+xml" title="Midnight Programmer" />


</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://prashantkhandelwal.github.io/">Midnight Programmer</a>
      </span>
      
      
      
      <div class="author-image">
        <img src="https://prashantkhandelwal.github.io//img/prashantk.jpg" alt="Author Image" class="img--circle img--headshot element--center"> 
      </div>
      
      <p class="site__description">
         Programming For Fun 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Midnight Programmer</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/archive/"><i class='fa fa-road'></i>
						<span>Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/top-posts/"><i class='fa fa-star fa-fw'></i>
						<span>Top Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/contact/"><i class='fa fa-envelope fa-fw'></i>
						<span>Contact</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/nullgap" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/khandelwal.p" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/prashantkhandelwal" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="http://feeds.feedburner.com/MidnightProgrammer" rel="me"><i class="fa fa-rss fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://instagram.com/prashantkhandelwal" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/khandelwalprashant" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://medium.com/@prashantkhandelwal" rel="me"><i class="fab fa-medium fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy; 2023 Pashant Khandelwal
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/in/"><img style="border-width: 0;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/in/88x31.png" alt="Creative Commons License" class="thinglinkFiltered"></a>
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
<div class="post-list">
  
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/capture-screenshot-and-description-of-a-web-page-using-go-and-chromedp/">Capture screenshot and description of a web page using Go and Chromedp</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Apr 5, 2023
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/chromedp">CHROMEDP</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/go">GO</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/web">WEB</a>
      
      
      
      
    </span>
    <p>Adding or sharing a link with a snapshot of a web page is a very useful feature in Microsoft Teams or in Zoom chat. This gives a user a way to quickly look at the web page snapshot and a small description about the link.</p>

<p>Go has an amazing library called <a href="https://github.com/chromedp/chromedp">chromedp</a> which allows you to perform some amazing tasks like taking screenshot, fill out a form and submit it, send key events, device emulation, script evaluation etc. You can look at the complete example list <a href="https://github.com/chromedp/examples">here</a>.</p>

<p>We are interested in taking a screenshot of the web page for the given URL. Chromedp allows you the take a screenshot of a specific element of the page or for the entire browser viewport.</p>

<p>The use case I am having is to capture just enough of the web page to give an idea to the user about the website. Looking at the screenshot and recalling whether one has visited this link or not is easier than looking at the link. Here is a sample code which will let you snap a screenshot of a given web page.</p>

<pre class="brush:ruby">
package main

import (
 "context"
 "crypto/rand"
 "fmt"
 "log"
 "os"
 "time"
 "unsafe"

 "github.com/chromedp/cdproto/emulation"
 "github.com/chromedp/chromedp"
)

const (
 UserAgentName = "Websnapv1.0"
 Path          = "images\\"
 Timeout       = 15
)

// https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-go
func GenRandStr(n int) string {
 var alphabet = []byte("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")
 b := make([]byte, n)
 rand.Read(b)
 for i := 0; i < n; i++ {
  b[i] = alphabet[b[i]%byte(len(alphabet))]
 }
 return *(*string)(unsafe.Pointer(&b))
}

func Snap(url string) (string, error) {
 ctx, cancel := chromedp.NewContext(context.Background())
 defer cancel()

 // Creating timeout for 15 seconds
 ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
 defer cancel()

 name := GenRandStr(12)
 var buf []byte
 var file = Path + name + ".png"

 err := chromedp.Run(ctx,
  emulation.SetUserAgentOverride(UserAgentName),
  chromedp.Navigate(url),
  //chromedp.FullScreenshot(&buf, 100),
  chromedp.CaptureScreenshot(&buf),
 )

 if err != nil {
  log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
  return "", err
 }

 if err := os.WriteFile(file, buf, 0o644); err != nil {
  log.Fatalf("ERROR:webext - Cannot create snap for the link - %s\n", url)
  file = ""
  return "", err
 }

 return file, nil
}

func main() {
 i, err := Snap("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
 if err != nil {
  log.Fatalf("ERROR: Unable to retrieve screenshot - %v", err.Error())
 }

 // print the image path
 fmt.Println(i)
}
</pre>

<p>Here, I have some <code>const</code> declared which are easy to understand. Then I have a random string generator which I found on Stackoverflow to generate random image names. In the end I have a function <code>snap</code> which takes a screenshot of the web page. Overall, this function is very simple to understand but I want you to pay special attention to this part of the function where <code>chromedp</code> is used.</p>

<pre class="brush:ruby">
err := chromedp.Run(ctx, 
  emulation.SetUserAgentOverride("Bindv1.0"), 
  chromedp.Navigate(url), 
  chromedp.CaptureScreenshot(&buf), 
 ) 
</pre>

<p>Now the <code>CaptureScreenshot</code> is a function which will capture a part of the web page. This function accepts the pointer to the buffer to which it writes the output eventually writes to an image file. Here is an example output:</p>

<p><img src="/images/screenshot-web-page-1.png" alt="Screenshot from `CaptureScreenshot` function" /></p>

<p>The next useful function that you can also use is called <code>FullScreenshot</code>. This function will let you capture the entire web page as an image. You can use this function with your functional tests to check how your web page looks when accessed from a different location or with different parameters. This function takes two parameters, the first is the pointer to the buffer, just like the one before and the second one is the <code>quality</code> of the image. As the screenshot is for the entire viewport or the web page, I am uploading an image displayed in an image viewer program to give you a perspective of the screenshot. Here is an example output:</p>

<p><img src="/images/Screenshot-full-viewport.png" alt="Screenshot from `FullScreenshot` function" /></p>

<p>With screenshots done, let’s also get some basic information about the web page as well. Let’s create a new method and name it <code>ExtractMeta</code>. It accepts URL of the web page as a parameter and returns a pointer to the <code>WebData</code> struct which holds value for <code>Title</code> and <code>Description</code> of the web page. This function looks exactly like the <code>Snap</code> function except for a slight change in the Run function usage and some variable declarations to hold returned values. Here is the code for extracting the metadata information:</p>

<pre class="brush:ruby">
var pageTitle, description string

var w = &WebData{}

err := chromedp.Run(ctx,
 emulation.SetUserAgentOverride(UserAgentName),
 chromedp.Navigate(url),
 chromedp.Title(&pageTitle),
 chromedp.Evaluate(`document.querySelector("meta[name^='description' i]").getAttribute('content');`, &description),
)

w.Title = pageTitle
w.Description = description
</pre>

<p>Notice that the <code>Run</code> function has additional parameters <code>chromedp.Evaluate</code> and <code>chromedp.Title</code>. The <code>chromedp.Title</code> returns the title of the web page. The <code>chromedp.Evaluate</code> function lets you evaluate or execute a <code>JavaScript</code> on the web page it is visiting and return the result so you can use it. For our use case, which is to get the description of the web page, we can execute the <code>document.querySelector</code> on the <code>meta</code> tags of the web page where the meta tag <code>name</code> equals to <code>description</code>. The <code>i</code> is the case-insensitivity qualifier here. Add the below code to the <code>main</code> function:</p>

<pre class="brush:ruby">
w, err := ExtractMeta("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
if err != nil {
 log.Fatalf("ERROR: Unable to retrieve metadata - %v", err.Error())
}
fmt.Println(w.Title)
fmt.Println(w.Description)
</pre>

<p>Executing above code will generate the output like this:</p>

<p><img src="/images/final-output.png" alt="Final output of the entire program" /></p>

<p>Similarly, you can also execute this function multiple times to get other information from the web page as desired.</p>

<p>Here is the complete code for reference:</p>

<pre class="brush:ruby">
package main

import (
    "context"
    "crypto/rand"
    "fmt"
    "log"
    "os"
    "time"
    "unsafe"

    "github.com/chromedp/cdproto/emulation"
    "github.com/chromedp/chromedp"
)

const (
    UserAgentName = "Websnapv1.0"
    Path          = "images\\"
    Timeout       = 15
)

type WebData struct {
    Title       string
    Description string
}

// https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-go
func GenRandStr(n int) string {
    var alphabet = []byte("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")
    b := make([]byte, n)
    rand.Read(b)
    for i := 0; i < n; i++ {
        b[i] = alphabet[b[i]%byte(len(alphabet))]
    }
    return *(*string)(unsafe.Pointer(&b))
}

func Snap(url string) (string, error) {
    ctx, cancel := chromedp.NewContext(context.Background())
    defer cancel()

    // Creating timeout for 15 seconds
    ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
    defer cancel()

    name := GenRandStr(12)
    var buf []byte
    var file = Path + name + ".png"

    err := chromedp.Run(ctx,
        emulation.SetUserAgentOverride(UserAgentName),
        chromedp.Navigate(url),
        //chromedp.FullScreenshot(&buf, 100),
        chromedp.CaptureScreenshot(&buf),
    )

    if err != nil {
        log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
        return "", err
    }

    if err := os.WriteFile(file, buf, 0o644); err != nil {
        log.Fatalf("ERROR:webext - Cannot create snap for the link - %s\n", url)
        file = ""
        return "", err
    }

    return file, nil
}

func ExtractMeta(url string) (*WebData, error) {
    ctx, cancel := chromedp.NewContext(context.Background())
    defer cancel()

    // Creating timeout for 15 seconds
    ctx, cancel = context.WithTimeout(ctx, time.Second*Timeout)
    defer cancel()

    var pageTitle, description string

    var w = &WebData{}

    err := chromedp.Run(ctx,
        emulation.SetUserAgentOverride(UserAgentName),
        chromedp.Navigate(url),
        chromedp.Title(&pageTitle),
        chromedp.Evaluate(`document.querySelector("meta[name^='description' i]").getAttribute('content');`, &description),
    )

    if err != nil {
        log.Fatalf("ERROR:webext - Unable to extract meta(s) from the given URL - %s\n", url)
        return nil, err
    }

    w.Title = pageTitle
    w.Description = description

    return w, nil
}

func main() {
    i, err := Snap("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
    if err != nil {
        log.Fatalf("ERROR: Unable to retrieve screenshot - %v", err.Error())
    }

    // print the image path
    fmt.Println(i)

    // Extract metadata of the page
    w, err := ExtractMeta("https://medium.com/@prashantkhandelwal/marvel-comics-universe-graph-database-7264381478e1")
    if err != nil {
        log.Fatalf("ERROR: Unable to retrieve metadata - %v", err.Error())
    }
    fmt.Println(w.Title)
    fmt.Println(w.Description)
}
</pre>

<p><strong>References</strong></p>

<ul>
<li><a href="https://github.com/chromedp/chromedp">Chromedp GitHub Repository</a></li>
<li><a href="https://github.com/chromedp/examples">Chromedp Examples GitHub Repository</a></li>
</ul>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/marvel-comics-universe-graph-db/">Marvel Comics Universe Graph Database</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Jan 3, 2023
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/.net">.NET</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/c">C#</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/database">DATABASE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/graph">GRAPH</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/gremlin">GREMLIN</a>
      
      
      
      
    </span>
    <p>In the past decade Marvel has gathered a lot of fans following which eventually led all the fans to know more about how the Marvel comics universe characters, stories, events are mapped or linked to each other.</p>

<p>In 2017 (if I am remembering it correctly), at Microsoft Build event, Microsoft announces Bot framework and did a demo with CosmosDB graph database which uses Gremlin query from <a href="https://tinkerpop.apache.org/">Apache TinkerPop</a>. It was a great demo, and I was really impressed by how they did it but unfortunately, I was unable to find the source code for that demo anywhere. So, I thought I should at least get the graph database for my own use and then sometime later will work on building a NLU bot.</p>

<p>To get started I will be setting up the database using Apache TinkerPop and not CosmosDB due to cost and development speed. Will make use of <a href="https://github.com/apache/tinkerpop/tree/master/gremlin-dotnet">Gremlin.NET</a> - a wrapper around Gremlin Query Language. Let&rsquo;s <a href="https://tinkerpop.apache.org/download.html">download Apache TinkerPop Gremlin Server and Console</a>. These will be downloaded in .zip file, so extract them into a folder and navigate to the <code>bin</code> directory inside each extracted folder and using the command/shell prompt execute the <code>.bat</code> file if you&rsquo;re on Windows else <code>.sh</code> file if you are on Linux or WSL on Windows.</p>

<p><img src="/images/gremlin-server-start.png" alt="Gremlin Server Start" />
<img src="/images/gremlin-console-start.png" alt="Gremlin Console Start" /></p>

<p>After both the server and console are running, go to console terminal window and connect to the local TinkerPop server. Note that the console is independent of the server running on the local machine. If you are assuming that it will automatically connect to the running local instance of the server, then you are wrong. Therefore, we have to connect to the local server instance by executing the below command in the Gremlin console.</p>

<pre class="brush: shell">
gremlin> :remote connect tinkerpop.server conf/remote.yaml session
</pre>

<p>If you are unable to connect to the local server instance, then it might be a problem with your config file (.yaml) which you can find under <code>conf</code> folder in your <code>console</code> folder. Here are the contents of my <code>remote.yaml</code> file.</p>

<pre class="brush: text">
hosts: [localhost]
port: 8182
serializer: { className: org.apache.tinkerpop.gremlin.driver.ser.GraphBinaryMessageSerializerV1, config: { serializeResultToString: true }}
</pre>

<p>With connection established, now we can import the <code>graphson</code> data in the database. You can also refer to my <a href="https://github.com/prashantkhandelwal/mcugraph">Github repo</a> where I have used the raw data from the web to generate the edges and vertices for all Marvel characters. The <a href="https://syntagmatic.github.io/marvel/data/hero-network.csv">raw data</a> which is in csv format has some repetitive connections. The repo code ensures that there are no duplicate connections. You can also refer to the code if you plan to connect and play with TinkerPop graph database. Running the code and setting up the database will be a bit time-consuming, so I would suggest to download the <code>mcu.json</code> file from the repo and then importing it, which will happen in a few seconds.</p>

<p>The data file which you downloaded from the repo <code>mcu.json</code> should be stored on the Gremlin server current working directory. After you place the file, execute the below command on the Gremlin console.</p>

<pre class="brush: shell">
gremlin> :> g.io("mcu.json").read().iterate()
</pre>

<p>The above command will take a few seconds to execute and then it will return you back to the <code>gremlin</code> console. We can now verify the data by executing this command.</p>

<pre class="brush: shell">
gremlin> :> graph
</pre>

<p>If all goes well, you should see the output below of the above command.</p>

<p><img src="/images/gremlin-marvel-data-stats.png" alt="Gremlin marvel database stats" /></p>

<p>Let&rsquo;s write some Gremlin queries and find out some information. Go to Gremlin console and test these below queries.</p>

<p>How many people does Cap know?</p>

<pre class="brush: shell">
gremlin> :> g.V().has("name","CAPTAIN AMERICA").outE("knows").count()
</pre>

<p>And who are those people?</p>

<pre class="brush: shell">
gremlin> :> g.V().has("name","CAPTAIN AMERICA").out("knows").values("name")
</pre>

<p>Characters who have <code>IRON</code> in their name. Note that this is case-sensitive.</p>

<pre class="brush: shell">
gremlin> :> g.V().has('name', containing('IRON')).values('name')
</pre>

<p>As this is a graph database, it will be nice if we can visualize the data visually. There are few visualization tools I have used so far and <a href="https://gdotv.com/">GDotV</a> seems to a be popular one.</p>

<p><img src="/images/gremlin-gdotv-explorer.png" alt="GDotV Greamlin Visualization Tool" /></p>

<p>You can also visualize using this simple open-source graph visualization tool called <a href="https://github.com/prabushitha/gremlin-visualizer">gremlin-visualizer</a>. There are other visualization tools as well in case you want to work with some advanced feature sets. I personally make use of the basic console and mix of <code>gdotv</code> <code>gremlin-visualizer</code> as it fits my needs. For example, you will be able to execute this query below and see the visualization in <code>gremlin-visualizer</code> but unable to get this query to execute in <code>gdotv</code> version 1.0.1.</p>

<pre class="brush: shell">
g.V().has('hero', 'id', "CAPTAIN AMERICA").outE("knows").inV()
</pre>

<p><img src="/images/gremlin-visualizer-ui.png" alt="Gremlin-Visualizer - Visualization Tool" /></p>

<p><strong>Reference &amp; Resources</strong></p>

<ul>
<li><a href="https://github.com/prashantkhandelwal/mcugraph/">Github - mcugraph</a></li>
<li><a href="https://github.com/apache/tinkerpop/tree/master/gremlin-dotnet">Github - Gremlin.NET</a></li>
<li><a href="https://github.com/prabushitha/gremlin-visualizer">Github - gremlin-visualizer</a></li>
<li><a href="https://kelvinlawrence.net/book/Gremlin-Graph-Guide.html">Kelvin Lawrence Book - Practical Gremlin</a></li>
<li><a href="https://tinkerpop.apache.org/docs/current/tutorials/getting-started/">Apache TinkerPop - Getting Started</a></li>
</ul>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/installing-openfaas-on-k3s-single-node/">Installing OpenFaaS On k3s (Single Node)</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Jan 4, 2021
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/cloud">CLOUD</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/linux">LINUX</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/open-source">OPEN SOURCE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/ubuntu">UBUNTU</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/k3s">K3S</a>
      
      
      
      
    </span>
    

<p>If you have ever got your hands on Azure Function or on AWS Lambda, then you might be familiar with the concept of serverless computing. So in order to test the concept of a function (serverless function), we have to have an Azure or an AWS account. The SDK from both the platforms allow you to build, develop and test the functions on your local development machine, but when it comes to production environment, you again have to turn yourself to Azure or AWS for hosting it. <a href="https://www.openfaas.com/">OpenFaaS</a> is an open-source product developed by <a href="https://github.com/alexellis">Alex Ellis</a> which help developers to deploy event-driven functions, time triggered and microservices to Kubernetes without repetitive, boiler-plate coding. Let&rsquo;s see how we can deploy OpenFaas on Ubuntu 20.04 LTS using <a href="https://k3s.io">k3s</a>. You can also make use of another Kubernetes flavour which suites your needs.</p>

<h3 id="installing-k3s"><strong>Installing k3s</strong></h3>

<p>I am making use of Lightweight Kubernetes also known as k3s. This is a certified Kubernetes distribution built for IoT and Edge computing.</p>

<pre class="brush:shell">
$ curl -sfL https://get.k3s.io | sh -
</pre>

<p><img src="/images/installing-k3s.png" alt="Installing k3s" /></p>

<p>After the installation is completed, you can check if the k3s service is running by executing the below command.</p>

<pre class="brush:shell">
$ sudo systemctl status k3s
</pre>

<p><img src="/images/k3s-service-status.png" alt="Check k3s service status" /></p>

<h3 id="install-faas-cli"><strong>Install faas-cli</strong></h3>

<p><code>faas-cli</code> is a command line utility which let you work with OpenFaaS.</p>

<pre class="brush:shell">
$ curl -sL https://cli.openfaas.com | sudo sh
</pre>

<p><img src="/images/installing-openfaas-cli.png" alt="Installing OpenFaaS CLI" /></p>

<h3 id="installing-arkade"><strong>Installing arkade</strong></h3>

<p><a href="https://github.com/alexellis/arkade">Arkade</a> is a Kubernetes app installer. It allows you to install apps and charts to your cluster in one command. The official documentation of OpenFaaS states that using <code>arkade</code> is the fastest option. If you wish you can also make use of <code>Helm</code> to install but as I am installing it on a single node machine, I will stick with <code>arkade</code> option.</p>

<p>Run the below command to download and install it.
<pre class="brush:shell">
$ curl -SLsf <a href="https://dl.get-arkade.dev/">https://dl.get-arkade.dev/</a> | sudo sh
</pre></p>

<p><img src="/images/installing-arkade.png" alt="Installing Arkade" /></p>

<h3 id="installing-openfaas"><strong>Installing OpenFaaS</strong></h3>

<p>Installing OpenFaaS with <code>arkade</code> is extremely simple and you can get the installation done by executing this command:</p>

<pre class="brush:shell">
$ arkade install openfaas
</pre>

<p>This should install OpenFaaS but unfortunately on my machine this results into an error. Below are the two screenshots that I took when I got this error. The first screenshot says there is a permission error in <code>/etc/rancher/k3s/k3.yaml</code>. For the resolution of this error, I changed the permission on the file to <code>744</code> and the error goes away.</p>

<p><img src="/images/installing-openfaas-using-arkade-error1.png" alt="Installing Arkade - Error 1" /></p>

<p>If you scroll down to the end of the command you will notice that there is another error which states that <code>Kubernetes cluster unreachable</code>.</p>

<p><img src="/images/installing-openfaas-using-arkade-error2.png" alt="Installing Arkade - Error 2" /></p>

<p>Even knowing that <code>k3s</code> service is up and running I was not able to figure out what could be a problem. So I searched the web and found <a href="https://github.com/k3s-io/k3s/issues/1126">this issue thread on Github</a> in which one of the <a href="https://github.com/k3s-io/k3s/issues/1126#issuecomment-560504204">commenters</a> were able to fix this error by running the below command.</p>

<pre class="brush:shell">
$ kubectl config view --raw > ~/.kube/config
</pre>

<blockquote>
<p>I tried this installation on Raspberry PI 4 running Raspbian buster x64 and there as well I saw these error messages.</p>
</blockquote>

<p>After this, you can run the installation of OpenFaaS using <code>arkade</code> again and this time it should be successfull. Here is the output on my system after the installation was successfull.</p>

<pre class="brush:plain">
prashant@ubuntu:~$ arkade install openfaas
Using Kubeconfig: /etc/rancher/k3s/k3s.yaml
Using kubeconfig: 
Node architecture: "amd64"
Client: "x86_64", "Linux"
2021/01/04 08:34:42 User dir established as: /home/prashant/.arkade/
Using Kubeconfig: 
[Warning] unable to create secret basic-auth, may already exist: Error from server (AlreadyExists): secrets "basic-auth" already exists
"openfaas" has been added to your repositories

VALUES values.yaml
Command: /home/prashant/.arkade/bin/helm [upgrade --install openfaas openfaas/openfaas --namespace openfaas --values /tmp/charts/openfaas/values.yaml --set clusterRole=false --set operator.create=false --set gateway.replicas=1 --set queueWorker.replicas=1 --set basic_auth=true --set serviceType=NodePort --set gateway.directFunctions=true --set openfaasImagePullPolicy=IfNotPresent --set faasnetes.imagePullPolicy=Always --set basicAuthPlugin.replicas=1 --set ingressOperator.create=false --set queueWorker.maxInflight=1]
Release "openfaas" does not exist. Installing it now.
NAME: openfaas
LAST DEPLOYED: Mon Jan  4 08:34:45 2021
NAMESPACE: openfaas
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
To verify that openfaas has started, run:

  kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas"
=======================================================================
= OpenFaaS has been installed.                                        =
=======================================================================

# Get the faas-cli
curl -SLsf https://cli.openfaas.com | sudo sh

# Forward the gateway to your machine
kubectl rollout status -n openfaas deploy/gateway
kubectl port-forward -n openfaas svc/gateway 8080:8080 &

# If basic auth is enabled, you can now log into your gateway:
PASSWORD=$(kubectl get secret -n openfaas basic-auth -o jsonpath="{.data.basic-auth-password}" | base64 --decode; echo)
echo -n $PASSWORD | faas-cli login --username admin --password-stdin

faas-cli store deploy figlet
faas-cli list

# For Raspberry Pi
faas-cli store list \
 --platform armhf

faas-cli store deploy figlet \
 --platform armhf

# Find out more at:
# https://github.com/openfaas/faas

Thanks for using arkade!
</pre>

<p>The output contains important information which we need to get started with <code>faas-cli</code> and <code>OpenFaaS</code>. As we have already install <code>faas-cli</code>, we will now need to forward the gateway to the machine.</p>

<p>First we will check the rollout status of the <code>gateway</code> by issuing the below command:</p>

<pre class="brush:shell">
$ kubectl rollout status -n openfaas deploy/gateway
</pre>

<p><img src="/images/checking-rollout-status-of-gateway-deployment.png" alt="Checking roolout status of gateway deployment" /></p>

<p>The above command should state that it is successfull. After this we can forward the gateway to the machine.</p>

<pre class="brush:shell">
$ kubectl port-forward -n openfaas svc/gateway 8080:8080 &
</pre>

<p><img src="/images/port-forwarding.png" alt="Port Forwarding" /></p>

<p>The <code>&amp;</code> sign in the end of the command will execute it in the background. You can type in <code>jobs</code> to check the status of the job.</p>

<p>We also need to check if the deployment is in ready state or not. To check the deployment state execute the command:</p>

<pre class="brush:shell">
$ kubectl get deployments -n openfaas -l "release=openfaas, app=openfaas"
</pre>

<p><img src="/images/post-installation-openfaas-check-deployments.png" alt="Post installation openfaas - check deployment" /></p>

<p>If any of the app deployed is not ready, you should be able to see it now. Check the <strong><code>READY</code></strong> column in the command output and you should see something <strong><code>0/1</code></strong>. This would mean that the deployment is not ready and you should check back in sometime. Once you have the output like the one in the screenshot above, you are good to go.</p>

<p>Now the last step is to acquire the password for OpenFaaS UI which we will use to manage OpenFaaS. To do that execute the below command:</p>

<pre class="brush:shell">
$ PASSWORD=$(kubectl get secret -n openfaas basic-auth -o jsonpath="{.data.basic-auth-password}" | base64 --decode; echo)
echo -n $PASSWORD | faas-cli login --username admin --password-stdin
</pre>

<p><img src="/images/get-password-for-openfaas-ui.png" alt="Get password for OpenFaaS UI" /></p>

<p>You can then view the password by printing the value of the <code>PASSWORD</code> variable using the <code>echo</code> command.</p>

<pre class="brush:shell">
$ echo PASSWORD
</pre>

<p>Copy and save the password securely.</p>

<p>Now let&rsquo;s try accessing the OpenFaaS UI (OpenFaaS Portal) by navigating to the <code>http://localhost:31112/ui</code> or by using the IP address of machine instead of localhost if you are accessign it from another machine on your network.</p>

<p><img src="/images/openfaas-portal-login.png" alt="Login prompt for OpenFaaS Portal" /></p>

<p><code>Username</code> is set to <code>admin</code> by default and the password is the one which you saved in the above step.</p>

<p>Click on the <code>Deploy New Function</code> link located at the center of the home page or at the left side bar. You will be able to see the list of the different functions which you can deploy by just selecting the function from the list and then clicking the <code>Deploy</code> button at the bottom of the dialog.</p>

<blockquote>
<p>Note that the list of functions that you see in the <code>Deploy new Function</code> dialog will be different on Raspberry PI as OpenFaaS will only list the functions which are available for the platform on which it is running.</p>
</blockquote>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/hosting-drawio-in-azure-webapp-containers/">Hosting Draw.IO In Azure Web App Containers</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Jan 20, 2019
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/azure">AZURE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/cloud">CLOUD</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/container">CONTAINER</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/docker">DOCKER</a>
      
      
      
      
    </span>
    <p><a href="https://www.draw.io/">Draw.IO</a> is a great alternative for Microsoft Visio. It allows me to quickly draw flowcharts and diagrams. I have been using this for a long time and the best part is that <a href="https://github.com/jgraph/drawio">Draw.IO is open source on Github</a> with web and offline (desktop) version. I personally use desktop version but what if I would like to host it in my own org or would like to work with the web instance instead of the desktop version.</p>

<p>The problem that I would be facing with the web version is that, it has some part of it written in Java. Fortunately, Draw.IO has an image hosted at docker hub form where I can pull the image and get it to work in no time. Instead of using the image on my local machine, I will try Web Apps for Containers in Azure. You may also know it as App Service in Azure.</p>

<p>To get started with <a href="https://azure.microsoft.com/en-in/services/app-service/containers/">Web Apps for Containers</a> in Azure. Create a new resource in Azure portal and then search for Web Apps for Containers.</p>

<p><img src="/images/webapps-containers.png" alt="Web apps for containers" /></p>

<p>Give a name of your web app and fill in other information. For the <code>OS</code>, I have selected <code>Linux</code>. The next step is to select the <a href="https://hub.docker.com/r/fjudith/draw.io">official draw.io image</a> from <a href="https://hub.docker.com/">docker hub</a>.</p>

<p><img src="/images/web-apps-drawio-image-container-dockerhub.png" alt="Add image from the docker hub public repo" /></p>

<p>You can also select the image you want to host by providing the tag name. By default, it would pick up the latest even if you don’t provide it. You can check the different tags for draw.io and select the one you want to use. After selecting the right image with the tag, click <strong>Apply</strong> button to select the image for the container. The click <strong>Create</strong> button to create the web app with this container.</p>

<blockquote>
<p>Note that there is no Standard pricing tier available when you select Web Apps for Container. It makes use of the Premium tier to run the containers in and as PaaS offering.</p>
</blockquote>

<p>After the web app has been created successfully, you can navigate to the <strong>Container settings</strong> section under <strong>Settings</strong> section quickly. If you were quick, you will be able to see the logs in real-time and also see how the image is being pulled from docker hub and getting started. Below are the screenshots of the logs generated by my web app.</p>

<p><img src="/images/web-apps-docker-log-1.png" alt="Docker image pull logs" /></p>

<p><img src="/images/web-apps-docker-log-2.png" alt="Docker image pull logs" /></p>

<p>You can clearly see in the logs that how the docker pull command was initiated and the command to start the container was executed. You can now navigate to the url of your web app to see the application in action.</p>

<p><img src="/images/drawio-container-running.png" alt="Docker image pull logs" /></p>

<p>When you visit the web app for the first time, it might take few extra seconds to load completely. This is a one time delay and after that the app will open up instantaneously.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/create-mount-and-unmount-img-files-in-ubuntu/">Create, Mount And Unmount .img Files In Ubuntu</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Oct 22, 2017
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/ubuntu">UBUNTU</a>
      
      
      
      
    </span>
    <p>Recently I moved from Windows to Ubuntu on one of my laptops and since then I was trying to look for the way to create a VHDs or some sort of image files that I can use as a container. So I looked up for the solution and found a working solution scattered though places. So here I am putting it in a blog post to have all it in one place.</p>

<p>First we need to create an image file (.img) by using the <code>dd</code> command. The dd command is used to copy and convert the file. The reason it is not called <code>cc</code> is because it is already being used by C compiler. Here goes the command.</p>

<pre class="brush: bash">
$ dd if=/dev/zero of=cdata.img bs=1G count=5
</pre>

<blockquote>
<p>Note: The command execution time depends on the size of the image you have opted out for.</p>
</blockquote>

<p><img src="/images/dd-command.png" alt="dd command" /></p>

<p>The <code>if</code> param stands for <code>input file</code> to refer the input file. As <code>if</code>, <code>of</code> stands for <code>output file</code> and this will create the <code>.img</code> file with the name you specify. The third param <code>bs</code> stands for <code>block size</code>. This will let you set the size of the image file. The <code>G</code> in the above command stands for <code>GigaByte</code> (GB). You can set the image size by specifying the block size. In this case <code>G</code> stands for GigaBytes (GB), <code>K</code> for KiloBytes (KB), <code>T</code> for TeraBytes (TB), <code>P</code> for Petabytes (PB) and so on. Here I am creating a 5 blocks of 1 GB each for the image file name <code>cdata</code>.</p>

<p>This command will create the .img file but you cannot mount this file as of yet. To do that you have to format the image so that it can have a file system. To do this make use of <code>mkfs</code> command.</p>

<pre class="brush: bash">
$ mkfs ext3 -F cdata.img
</pre>

<p>I am creating an <code>ext3</code> filesystem on my image file. <code>-F</code> is to force the operation. Here is the output of the command.</p>

<p><img src="/images/mkfs-command.png" alt="mkfs command" /></p>

<p>Now we can mount the image file by using the <code>mount</code> command:</p>

<pre class="brush: bash">
$ sudo mount -o loop cdata.img ~/Desktop/HDD/
</pre>

<p>With the success of the above command, you can see the image mounted on your desktop. You can unmount the image by clicking the eject or unmount button as shown in the below screenshot or you can execute the <code>umount</code> command to do that.</p>

<p><img src="/images/ui-diskmount.png" alt="disk mounted" /></p>

<p>Unmounting the image by using command line.</p>

<pre class="brush: bash">
$ sudo umount ~/Desktop/HDD
</pre>

  </div>
  
</div>


<ul class="pagination">
    
    <li class="page-item">
        <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/33/">33</a></li>
    
    
    <li class="page-item">
    <a href="/page/3/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/page/33/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


        </div>
        



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-QYXJT2TJCG', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css"
  rel="stylesheet"
/>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCss.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushSql.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPowerShell.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushRuby.min.js"
></script>

<script>
  SyntaxHighlighter.defaults["gutter"] = true;
  SyntaxHighlighter.defaults["smart-tabs"] = true;
  SyntaxHighlighter.defaults["auto-links"] = true;
  SyntaxHighlighter.defaults["collapse"] = false;
  SyntaxHighlighter.defaults["light"] = false;
  SyntaxHighlighter.defaults["tab-size"] = 4;
  SyntaxHighlighter.defaults["toolbar"] = false;
  SyntaxHighlighter.defaults["wrap-lines"] = true;
  SyntaxHighlighter.all();
</script>


    </body>
</html>
