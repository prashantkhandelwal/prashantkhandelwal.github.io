<!DOCTYPE html>
<html lang="en-us">
    
<head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.49" />

    

<title>Midnight Programmer</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Midnight Programmer"/>
<meta name="twitter:description" content="Programming For Fun"/>

<meta property="og:title" content="Midnight Programmer" />
<meta property="og:description" content="Programming For Fun" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://prashantkhandelwal.github.io/" />
<meta property="og:updated_time" content="2016-10-03T22:12:00&#43;00:00"/><meta property="og:site_name" content="Midnight Programmer" />


    


<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.css" media="print">


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

<link href="https://prashantkhandelwal.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Midnight Programmer" />
<link href="https://prashantkhandelwal.github.io/index.xml" rel="feed" type="application/rss+xml" title="Midnight Programmer" />


</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://prashantkhandelwal.github.io/">Midnight Programmer</a>
      </span>
      
      
      
      <div class="author-image">
        <img src="https://prashantkhandelwal.github.io//img/prashantk.jpg" alt="Author Image" class="img--circle img--headshot element--center"> 
      </div>
      
      <p class="site__description">
         Programming For Fun 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Midnight Programmer</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/archive/"><i class='fa fa-road'></i>
						<span>Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/top-posts/"><i class='fa fa-star fa-fw'></i>
						<span>Top Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/contact/"><i class='fa fa-envelope fa-fw'></i>
						<span>Contact</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/prashantkhandelwal" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="http://feeds.feedburner.com/MidnightProgrammer" rel="me"><i class="fa fa-rss fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://instagram.com/prashantkhandelwal" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/khandelwalprashant" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://medium.com/@prashantkhandelwal" rel="me"><i class="fab fa-medium fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
</section>

      </div>
    </div>
    <p class="copyright">
      &copy; 2025 Pashant Khandelwal
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.5/in/"><img style="border-width: 0;" src="https://i.creativecommons.org/l/by-nc-sa/2.5/in/88x31.png" alt="Creative Commons License" class="thinglinkFiltered"></a>
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
<div class="post-list">
  
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/get-the-correct-file-paths-in-net-core/">Get The Correct File Paths In .NET Core</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Oct 3, 2016
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/.net-core">.NET CORE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/asp.net-mvc">ASP.NET MVC&#34;</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/ubuntu">UBUNTU</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/web">WEB</a>
      
      
      
      
    </span>
    <p>I run a custom blog engine I wrote myself on MVC 4 and as you would have thought it is on Windows hosting. I am re-writing my blog engine in .NET Core so that I can get it running on a Linux hosting as well. I am using Windows machine and Visual Studio Community Edition to write it and using a Ubuntu VM box to test it. My current blog uses SQL Server as a back-end but Linux does not support SQL Server and therefore I have to move to MySQL or any other No-SQL database available for Linux distros. For now I will be saving everything on the disk in JSON format.</p>

<p>The problem comes when I switch from database to file system. Both Windows and Linux file systems are different, so when working I hard-coded the data folder which holds all the posts for my blog. I publish the solution and deploy it to Ubuntu VM. I started the server and it ended up showing me this error in the console.</p>

<p><img src="/images/dotnet-prod.png" alt="Dotnet production command" /></p>

<p>Notice the path of the data folder in the above screenshot. The path I am referring in the code ends up with backward slash which is not a UNIX format. Also a thing to note here is that UNIX follows a strict naming convention unlike Windows. For example, in Windows Data and data are same, but in UNIX they are not. Because I have hard-coded the path in my application while developing, it will end up in an error on UNIX machine.</p>

<p>To make the paths consistent in your application, I have to make use of the <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.io">System.IO</a> namespace <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.io.path">Path</a> class&rsquo;s <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.io.path#System_IO_Path_Combine_System_String_System_String_">Combine</a> method. <code>Combine</code> method is an overloaded method. If you are hearing this method for the first time then make sure you read the documentation. This method renders the correct path based on the platform my code is executing. So instead of doing something like this.</p>

<pre class="brush: csharp">
var _posts = Directory.EnumerateFiles("Data\\Posts");
</pre>

<p>I have done something like this.</p>

<pre class="brush: csharp">
string posts = Path.Combine("Data", "Posts");
_files = Directory.EnumerateFiles(posts);
</pre>

<p>In short, if you are developing a .NET Core application targeting Windows along with UNIX and OSX, then make sure that you follow this approach to get the correct paths or else you will end up with an exception and your website inaccessible.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/visualizing-adxl345-accelerometer-output-in-windows-forms-from-raspberry-pi-2/">Visualizing ADXL345 Accelerometer Output In Windows Forms From Raspberry PI 2</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Sep 26, 2016
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/c">C#</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/raspberry-pi">RASPBERRY PI</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/windows">WINDOWS</a>
      
      
      
      
    </span>
    

<p>I have been playing a lot with Raspberry PI and Python these days and have also started a side project to create robot car controller with a Xbox 360 wireless controller. I am planning to controller a robot car using a custom interface from my Windows machine. Initially I tried with <a href="https://riverbankcomputing.com/software/pyqt/intro">PyQt</a> but I dropped the idea for now as Python is not my primary expertise and it will take some time for me to learn the basics and get into some serious coding. Controlling something remotely or visualizing the information from your device on the UI is always better. For a proof of concept I built a Windows Forms application which will request the output from Raspberry PI over TCP and then visualize it on the UI using a wonderful chart library that I found today. There is a slight change in the Python code as I have to transmit readings from Raspberry PI over TCP so my Windows Forms application can read the output and utilize it to visualize it.</p>

<p><img src="/images/azure-iot-raspberry.png" alt="RaspberryPi Azure IoT Diagram" /></p>

<h4 id="raspberry-pi-python-application">Raspberry PI Python Application</h4>

<p>Reading the <a href="https://www.sparkfun.com/products/9836">ADXL345</a> output is fairly simple and you can do this without any problem by using Adafruit&rsquo;s <a href="https://github.com/adafruit/Adafruit_Python_ADXL345">ADXL345 Python library</a>. This library will get you started in a jiffy and you will have your readings. I am not going into the details about the different features of the library I am using and ADXL345. The only thing you will have to do is to wire ADXL345 to your Raspberry PI and fire the example code you got from Adafruit&rsquo;s repository from Github. If you have set it up correctly this, you will see X, Y, Z values on your terminal. If the terminal displays <code>0s</code> for all the three axis then there is something wrong with the wiring (assuming you are using the example code). This is how your writing should be like.</p>

<p><img src="/images/raspberrypi-fritz-sketch.png" alt="Raspberry Pi Fritzing Sketch" /></p>

<p>Now I have made slight changes in the code so that I can send the data over TCP. I have created a simple TCP server which exposes Raspberry PI through IP address and a port number. This is the complete code for reading values from ADXL345.</p>

<pre class="brush: python">
import Adafruit_ADXL345
import socket
 
HOST = "192.168.1.8"
PORT = 50007
 
accel = Adafruit_ADXL345.ADXL345()
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(1)
conn, addr = s.accept()
 
while 1:
    data = conn.recv(1024)
 
    if data.strip() == "adxl":
        x, y, z = accel.read()
        data = 'X:' + str(x) + '|Y:' + str(y) + '|Z:' + str(z)
        conn.send(data)
</pre>

<p>In the code, you can see that I am not just transmitting the readings just like that. I only transmit when there is a request from another application is there to get the readings. This is a good approach as I don&rsquo;t the PI to transmit the readings even if nobody is requesting it. I am sending a single string as a response which I am going to read at my Windows Forms application and use it.</p>

<blockquote>
<p>You need to change the IP address and port number according to your Pi&rsquo;s configuration.</p>
</blockquote>

<p>Once this is done you can then execute the script from the terminal by firing the below command</p>

<pre class="brush: bash">
sudo python adxl.py
</pre>

<p>This is it from Raspberry PI side. Let&rsquo;s take a look from the Windows side now.</p>

<h4 id="windows-forms-application">Windows Forms Application</h4>

<p>This will be a simple Windows Forms application which will connect to the Raspberry PI using the Pi&rsquo;s IP address and the port on which the server is running. The Windows Form application is also a TCP client which sends a request to Raspberry PI for the updated readings from ADXL345. As I mentioned above in the Python code that the readings are not just being transmitted but a client has to send a request to to get the readings.</p>

<p>Let&rsquo;s get started with the visualizing part. While was searching for a perfect charting library, I came across this wonderful library called <a href="https://lvcharts.net/">Live Charts</a>. This library is open-source, easy to use, has lots of awesome charts and a <a href="https://lvcharts.net/App/examples/wpf/start">very robust documentation</a> and moreover it supports Windows Forms as well as on WPF applications. I highly recommend you to look at the examples to get the idea about this library.</p>

<p>As usual, I will be using Nuget command to install the library.</p>

<pre class="brush: plain">
PM> Install-Package LiveCharts.WinForms
</pre>

<p>You also have to add the custom controls in the toolbox. You can follow the steps here to add the Live Charts control in the toolbox. In the design mode, choose the <code>Cartesian Chart</code> control from the toolbox and add it to the form. After adding the control to the form, I have dock it to the top of the form so I can utilize the lower section of the form to display the readings in numbers. Here is how my form looks like in design mode.</p>

<p><img src="/images/winform-design-view.png" alt="Windows Forms design view" /></p>

<p>After the designing for the form is complete, I can initialize the chart to display the readings from Raspberry PI. The chart require few things to be setup before it can start displaying the data correctly. The accelerometer I am using is a 3-axis accelerometer and therefore it is going to send me readings for 3 axis i.e X, Y and Z. This means I will be needing 3 line series to visualize the information from accelerometer. To have 3 line series display the data I have to use <code>CharValues</code> class which will let me display the readings in the line series. As I have to update my chart when I request the new readings from Raspberry PI, I have to use <code>ObservableValue</code> type. The <code>ObservableValue</code> will make sure that whenever there is a change in the value, it gets reflected in the chart and therefore keeping the chart always up to date.</p>

<pre class="brush: csharp">
public ChartValues&lt;ObservableValue&gt; Values_X { get; set; }
public ChartValues&lt;ObservableValue&gt; Values_Y { get; set; }
public ChartValues&lt;ObservableValue&gt; Values_Z { get; set; }
</pre>

<p>Because I am going to make request to the server running on my Raspberry PI and request for the ADXL345 readings, I have to create a TCP client in order to do so.</p>

<pre class="brush: csharp">
Socket server;
IPEndPoint ipEndPoint;
byte[] data;
</pre>

<p>When the application is loaded, I want to make connection to Raspberry PI by using it&rsquo;s IP address and port number on which the server is running on. To do this I will add the below code to the constructor of my application.</p>

<pre class="brush: csharp">
 
ipEndPoint = new IPEndPoint(
                IPAddress.Parse("192.168.1.8"), 50007);
 
server = new Socket(AddressFamily.InterNetwork,
               SocketType.Stream, ProtocolType.Tcp);
 
try
{
    server.Connect(ipEndPoint);
}
catch (SocketException)
{
    MessageBox.Show("Unable to connect to server.", "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
    return;
}
</pre>

<p>The above code is self-explanatory as I am just connecting to Raspberry PI.</p>

<p>In the form load event, I have to initialize chart values and add 3 line series to my <code>CartesianChart</code> for X, Y and Z axis respectively. In my case the name of the Cartesian Chart is <code>ADXLViz</code>.</p>

<pre class="brush: csharp">
Values_X = new ChartValues&lt;ObservableValue&gt;();
Values_Y = new ChartValues&lt;ObservableValue&gt;();
Values_Z = new ChartValues&lt;ObservableValue&gt;();
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_X,
    Title = "X",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_Y,
    Title = "Y",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
 
ADXLViz.Series.Add(new LineSeries
{
    Values = Values_Z,
    Title = "Z",
    StrokeThickness = 4,
    PointGeometrySize = 0,
    DataLabels = true
});
</pre>

<p>Play around with different properties in the <code>LineSeries</code> class and set the output that suits your need or your eye. Notice the Values properties in the <code>LineSeries</code> class which holds the value which is received from Raspberry PI.</p>

<p>I am requesting the readings from Raspberry PI every 500ms and to do this I am using a <code>Timer</code> class. This is easy to use and configure. Just drag and drop the <code>Timer</code> control from the toolbox. In the properties change the <code>Interval</code> property to <code>500</code> and <code>Enabled</code> to <code>True</code>. After this I set the <code>Tick</code> event which will request the new readings every 500ms.</p>

<pre class="brush: csharp">
string stringData;
server.Send(Encoding.ASCII.GetBytes("adxl"));
data = new byte[1024];
int recv = server.Receive(data);
stringData = Encoding.ASCII.GetString(data, 0, recv);
string[] adxl = stringData.Replace(" ", "").Split('|');
 
Values_X.Add(new ObservableValue(Convert.ToDouble(adxl[0].Split(':')[1])));
Values_Y.Add(new ObservableValue(Convert.ToDouble(adxl[1].Split(':')[1])));
Values_Z.Add(new ObservableValue(Convert.ToDouble(adxl[2].Split(':')[1])));
 
if (Values_X.Count &gt; 10) Values_X.RemoveAt(0);
if (Values_Y.Count &gt; 10) Values_Y.RemoveAt(0);
if (Values_Z.Count &gt; 10) Values_Z.RemoveAt(0);
 
X_Label.Text = Convert.ToString(adxl[0].Split(':')[1]);
Y_Label.Text = Convert.ToString(adxl[1].Split(':')[1]);
Z_Label.Text = Convert.ToString(adxl[2].Split(':')[1]);
</pre>

<p>The <code>stringData</code> variable holds the response or reading which is received from Raspberry PI. If you check the Python code above you will see that the response is being sent in a single string called <code>data</code>. I am splitting the string here and extracting the values and setting it to <code>ChartValues&lt;ObservableValue&gt;</code> object. This will render all the 3 line series chart and update it with the readings received from PI. But the problem here will be that in few minutes the chart will be hard to see due to lot of data congestion in chart. In order to overcome this problem, I have removed the first value from all the 3 line series when the chart displays more than 10 values. You can change the value from 10 to whatever suits you.</p>

<p><img src="/images/adxl345-viz-winform.png" alt="ADXL345 application output" /></p>

<p>The overall idea of building this application is to see whether it is possible or easy to communicate from Raspberry PI apart from using frameworks like <a href="http://webiopi.trouch.com/">WebioPI</a> or <a href="http://flask.pocoo.org/">Flask</a>. The complete source code for Raspberry PI and Windows Forms application is <a href="https://github.com/prashantkhandelwal/Pi-Code/tree/master/ADXL345%20Visualizer">available on Github</a> along with Fritzing sketch file and additional instructions to install the dependencies.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/building-angular-2-app-with-web-api-and-net-core/">Building Angular 2 App With Web API And .NET Core</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> May 21, 2016
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/.net-core">.NET CORE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/asp.net-mvc">ASP.NET MVC</a>
      
      
      
      
    </span>
    <p>Setting up the new Angular 2 app with Web API and .NET core is easy but can be a bit tricky. The older beta releases of Angular 2 works fine as there are not many files to refer and to work with. When I started using Angular 2 it was in RC1 and the way the files are being referenced in the app is bit different than the older versions of Angular 2. I don&rsquo;t want to repeat these steps again and again so I put up a Github repo for this seed project. You clone it and hit F5 and you will have your Angular 2 app with Web API.</p>

<blockquote>
<p>At the time of writing this post I am using .NET Core version 1.0.0-preview1-002702. The complete seed project is available on <a href="https://github.com/prashantkhandelwal/Angular2WebAPI-Seed">GitHub</a>.</p>
</blockquote>

<p>Here is how I did it. Select <code>ASP.NET Core Web Application (.NET Core)</code>. I have installed the new .NET Core RC2. Name the project as you like.</p>

<p><img src="/images/vs-new-project.png" alt="Visual Studio New Project" /></p>

<p>Select the <code>Web API</code> project template.</p>

<p><img src="/images/vs-new-add-api.png" alt="Visual Studio Add Web API" /></p>

<p>After the project creation is successfull. The first thing is to create a <code>Views</code> folder. The folder structure is like the same like it is for MVC application. This is how the folder structure looks like.</p>

<p><img src="/images/vs-view-project-files.png" alt="Visual Studio Project Files View" /></p>

<p>Because its a a Web API project, by default it will not render the views and therefore we have to add some dependencies in <code>project.json</code> file.</p>

<pre class="brush: plain">
"Microsoft.AspNetCore.StaticFiles": "1.0.0-rc2-final",
"Microsoft.AspNetCore.Mvc.TagHelpers": "1.0.0-rc2-final",
"Microsoft.AspNetCore.Mvc.WebApiCompatShim": "1.0.0-rc2-final"
</pre>

<p>The <code>project.json</code> file is different than that of the older version of the .NET Core. You will see the difference when you see it.
Next we set the routes for the views we have in the <code>Startup.cs</code> file.</p>

<pre class="brush: csharp">
app.UseMvc(routes =&gt;
{
    routes.MapRoute("default",
                    "{controller=Home}/{action=Index}/{id?}");
 
    routes.MapWebApiRoute("defaultApi",
                          "api/{controller}/{id?}");
});
</pre>

<p>The routes are now set and you can run the application and check if you can see the view or not. Once that is set, let start adding the support for Angular. Here is the list of the files which we need to add.</p>

<p><code>tsconfig.json</code> file</p>

<p><img src="/images/add-tsconfig-file.png" alt="Add tsconfig.json file" /></p>

<p>Add the below code to the file and save it.</p>

<pre class="brush: plain">
{
  "compilerOptions": {
    "target": "es5",
    "module": "system",
    "moduleResolution": "node",
    "sourceMap": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "removeComments": false,
    "noImplicitAny": false,
    "rootDir": "wwwroot",
    "outDir": "wwwroot",
    "listFiles": true,
    "noLib": false,
    "diagnostics": true
  },
  "exclude": [
    "node_modules"
  ]
}
</pre>

<p><code>typings.json</code> file</p>

<p>Add a blank <code>.json file</code> and name it <code>typings.json</code></p>

<p><img src="/images/add-typings.json.png" alt="Add typings.json file" /></p>

<p>Add below lines to the <code>typings.json</code> file.</p>

<pre class="brush: plain">
{
  "ambientDependencies": {
    "es6-shim": "registry:dt/es6-shim#0.31.2+20160317120654",
    "jasmine": "registry:dt/jasmine#2.2.0+20160412134438"
  }
}
</pre>

<p>As per the official <a href="https://angular.io/docs/ts/latest/quickstart.html">Angular documentation</a>, we will stick with <code>NPM</code> to fulfill the client-side dependencies. Start with adding new <code>npm Configuration File</code>. The content of the <code>NPM</code> file is almost the same, but I made few changes as per my requirement. Here is the complete configuration file.</p>

<p><img src="/images/npm-configuration-file.png" alt="NPM Configuration File" /></p>

<pre class="brush: plain">
{
  "name": "Angular2WebAPI-Seed",
  "version": "1.0.0",
  "scripts": {
    "postinstall": "typings install"
  },
  "license": "ISC",
  "dependencies": {
    "@angular/common": "2.0.0-rc.1",
    "@angular/compiler": "2.0.0-rc.1",
    "@angular/core": "2.0.0-rc.1",
    "@angular/http": "2.0.0-rc.1",
    "@angular/platform-browser": "2.0.0-rc.1",
    "@angular/platform-browser-dynamic": "2.0.0-rc.1",
    "@angular/router": "2.0.0-rc.1",
    "@angular/router-deprecated": "2.0.0-rc.1",
    "@angular/upgrade": "2.0.0-rc.1",
 
    "lodash": "4.12.0",
    "systemjs": "0.19.27",
    "es6-shim": "^0.35.0",
    "reflect-metadata": "^0.1.3",
    "rxjs": "5.0.0-beta.6",
    "zone.js": "^0.6.12",
    "angular2-in-memory-web-api": "0.0.7",
    "bootstrap": "^3.3.6"
  },
  "devDependencies": {
    "gulp": "3.9.1",
    "concurrently": "^2.0.0",
    "typescript": "^1.8.10",
    "typings": "^0.8.1"
  }
}
</pre>

<p>Notice the <code>postinstall</code> section in the npm configuration file. In this section we are installing the types required by our Angular 2 application. Now we can start setting up the Angular stuff in the <code>wwwroot</code> folder. Create an <code>app</code> and <code>js</code> folder inside this folder. Inside <code>app</code> folder create a new <code>.ts</code> file (TypeScript file). Here is the folder structure looks like in the <code>wwwroot</code> folder.</p>

<p><img src="/images/angular-files.png" alt="Angular Files Structure" /></p>

<p>You can see a <code>system.config.js</code> file is the same as you can see the Angular quickstart guide. I just have map the paths for the dependencies so that can be loaded without any problem. The <code>main.ts</code> file will be the main bootstrapper and <code>app.component.ts</code> file is the component file which will render the content on the page. At this point running the application will fail and it will give you several warnings and errors. To resolve that we need to add the references and we can do this easily by using a gulp file. The gulp file will automate the copying of dependencies in the <code>wwwroot</code> folder and ease our task.</p>

<p><img src="/images/add-gulp-config-file.png" alt="Add Gulp Configuration File" /></p>

<p>The content of the gulp file in this case looks like this.</p>

<pre class="brush: plain">
/// <binding BeforeBuild='default' />
 
var _ = require('lodash');
var gulp = require('gulp');
 
var js = [
    'node_modules/zone.js/dist/zone.min.js',
    'node_modules/systemjs/dist/system.js',
    'node_modules/reflect-metadata/Reflect.js',
    'node_modules/es6-shim/es6-shim.min.js'
];
 
var map = [
    'node_modules/es6-shim/es6-shim.map',
    'node_modules/reflect-metadata/reflect.js.map',
    'node_modules/systemjs/dist/system.js.map'
];
 
var folders = [
    'node_modules/@angular/**/*.*',
    'node_modules/rxjs/**/*.*'
];
 
gulp.task('copy-js', function () {
    _.forEach(js, function (file, _) {
        gulp.src(file)
       .pipe(gulp.dest('./wwwroot/js'))
    });
});
 
gulp.task('copy-map', function () {
    _.forEach(map, function (file, _) {
        gulp.src(file)
        .pipe(gulp.dest('./wwwroot/js'))
    });
});
 
gulp.task('copy-folders', function () {
    _.forEach(folders, function (folder) {
        gulp.src(folder, { base: 'node_modules' })
            .pipe(gulp.dest('./wwwroot/js'))
    });
})
 
gulp.task('default', ['copy-js', 'copy-map', 'copy-folders']);
</pre>

<p>Notice the very first line in the file above. We want to execute the task on every time before the build is triggered. The gulp file will only be copying the required files to the <code>js</code> folder and other unnecessary files will not be required. After the task is executed here is the how the final directiry structure will look like under <code>wwwroot</code>.</p>

<p><img src="/images/angular-wwwroot-content.png" alt="Angular wwwroot content" /></p>

<p>Depending on the selector you have in your component, you need to add the selector to your view. In my case the selector is <code>app</code>, hence add <code>&lt;app&gt;&lt;/app&gt;</code> in your <code>Index.cshtml</code> file.</p>

<p>After you set up the index page, there is one more thing that you have to do is to set the launch URL.</p>

<p><img src="/images/launch-settings.png" alt="App Launch Settings" /></p>

<p>The URL may change and differ as per your API endpoint. Press F5 to run the application.</p>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/dev-buzz-3-bookmarks/">Dev Buzz #3 - Bookmarks</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Apr 29, 2016
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/devbuzz">DEVBUZZ</a>
      
      
      
      
    </span>
    

<div style="text-align: -webkit-center;">
<img src="/images/devbuzz1.jpg" alt="Devbuzz Image" />
</div>

<h4 id="net-core">.NET Core</h4>

<ul>
<li><a href="http://jameschambers.com/2016/04/github-authentication-asp-net-core/">GitHub Authentication with ASP.NET Core</a></li>
<li><a href="http://rehansaeed.com/social-taghelpers-for-asp-net-core/">Social TagHelpers for ASP.NET Core</a></li>
<li><a href="https://blogs.msdn.microsoft.com/webdev/2016/03/28/dependency-injection-in-asp-net-core/">Dependency Injection in ASP.NET Core</a>
<a href="http://dotnetliberty.com/index.php/2016/04/11/asp-net-core-custom-service-based-on-request/">ASP.NET Core: Custom Service Based on Request</a></li>
</ul>

<h4 id="visual-studio-visual-studio-code">Visual Studio/Visual Studio Code</h4>

<ul>
<li><a href="http://tattoocoder.azurewebsites.net/setting-up-asp-net-core-debugging-in-vs-code">Setting up ASP.NET Core debugging in VS Code</a></li>
<li><a href="https://blogs.msdn.microsoft.com/dotnet/2016/04/18/whats-new-for-the-net-native-compiler-and-runtime-in-visual-studio-2015-update-2/">What’s new for the .NET Native Compiler and Runtime in Visual Studio 2015 Update 2</a></li>
<li><a href="https://blogs.msdn.microsoft.com/dotnet/2016/04/02/whats-new-for-c-and-vb-in-visual-studio/">What’s New for C# and VB in Visual Studio</a></li>
<li><a href="http://jameschambers.com/2016/02/building-your-project-should-be-pretty-quick/">Tips for Speeding Up Visual Studio</a></li>
</ul>

<h4 id="open-source">Open Source</h4>

<ul>
<li><a href="https://github.com/baedert/corebird">Corebird - Native GTK+ Twitter Client</a></li>
<li><a href="https://github.com/OpenLiveWriter/OpenLiveWriter.Github.io">OpenLiveWriter - WLW</a></li>
</ul>

<h4 id="miscellaneous">Miscellaneous</h4>

<ul>
<li><a href="http://www.omgubuntu.co.uk/2016/04/10-things-to-do-after-installing-ubuntu-16-04-lts">16 Things To Do After Installing Ubuntu 16.04 LTS</a></li>
<li><a href="http://nickcraver.com/blog/2016/02/17/stack-overflow-the-architecture-2016-edition/">Stack Overflow: The Architecture - 2016 Edition</a></li>
</ul>

  </div>
  
  <div class="post-list__item">
    <span class="item__title--big">
      <a href="/post/markdown-parser-taghelper-in-aspnet-mvc-6/">Parsing Markdown Using Custom TagHelper In ASP.NET MVC 6</a>
      
    </span>
    <span class="item__date">
      <i class="fas fa-calendar-alt"></i> Nov 30, 2015
    </span>
    
    <span>
      
      
      
      
      
      
      <a class="badge badge-category" href="/category/.net-core">.NET CORE</a>
      &nbsp;
      
      <a class="badge badge-category" href="/category/asp.net-mvc">ASP.NET MVC</a>
      
      
      
      
    </span>
    <p>Previous versions of MVC allows us to write <a href="https://msdn.microsoft.com/en-us/library/system.web.mvc.htmlhelper%28v=vs.118%29.aspx">HtmlHelpers</a> which does a pretty good job then and they are doing it now as well. But in MVC 6, the ASP.NET team has introduced TagHelpers.</p>

<p>Parsing <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> in .NET is way too simple than one can imagine. Thanks to Stackoverflow&rsquo;s <a href="https://code.google.com/p/markdownsharp/">MarkdownSharp</a> and Karlis Gangis&rsquo;s CommonMark.NET. I use CommonMark.NET as it provides a much faster parsing than other libraries. The blogging platform I use is a custom blogging engine I wrote in MVC4. The post content is saved in HTML which makes my raw HTML way to messy when compared to simple markdown syntax. I have no plans to change the way it is right now, but for the other simple application which is quite similar to notes taking or blogging apps, I would like to save the content in markdown.</p>

<p>I will start with a simple implementation of this custom TagHelper and then then we can look into the other ways to enhance it. Here is how easy it is to create your custom TagHelper.</p>

<p>Create a new class file <code>MarkdownTagHelper.cs</code>. Inside the file, rename the class name to match the file name or you can change the name way you like. In my case I am keeping the class name as same as the file name.</p>

<blockquote>
<p>Pay attention to the name of the custom TagHelper. By design, compiler will remove the word TagHelper from the class name and the rest of the name will become your custom TagHelper name.</p>
</blockquote>

<p>The next step is to inherit our class with <code>TagHelpers</code> class. Every custom TagHelper will inherit this class. Just like the UserControl class when creating a custom user control. The TagHelper provide us two virtual methods, <code>Process</code> and a <code>ProcessAsync</code> method which we will be going to override to implement our custom logic for our custom markdown TagHelper. The first parameter is the <code>TagHelperContext</code> which holds the information about the current tag and the second parameter is <code>TagHelperOutput</code> object represents the output being generated by the TagHelper. As we need to parse the markdown in our razor view pages, we need to add reference of CommonMark.Net library. Use the below Nuget command to add it to your current project.</p>

<pre class="brush: plain">
Install-Package CommonMark.Net
</pre>

<p>Till here this is how the code will look like.</p>

<p><img src="/images/code-md-scrshot.png" alt="Markdown screenshot in Visual Studio" /></p>

<p>So now we have our custom TagHelper that will let us parse the markdown. But to use it in our views we need to opt-in for this TagHelper in the <code>_ViewImports.cshtml</code> file. To enable your custom TagHelper just type in like this:</p>

<pre class="brush: csharp">
@addTagHelper "*, WebApplication1"
</pre>

<p>Your custom tag helper would have been turned purple in color on the view page. It is similar to the line above it where <code>@addTagHelper</code> is importing all the TagHelpers from the given namespace. If you are not interested in opting-in for all the TagHelpers in the given namespace then make use of the <code>@removeTagHelper</code> to disable the TagHelpers you don’t need. For this I want all the tag helpers I have created to be a part of the application and hence the * symbol.</p>

<p>In your view, where you want to use this just type in <code>&lt;markdown&gt;</code> and inside this tag you should have your markdown. To test it, you can view the any raw file in Github and copy the text. I am using <a href="https://raw.githubusercontent.com/Knagis/CommonMark.NET/master/README.md">README.md</a> from CommonMark.NET and it rendered perfectly.</p>

<blockquote>
<p>Caution: When copy-pasting the markdown code from anywhere to your view make sure that you do not have a whitespace in the front of the line. This is only applicable when you are working with the in-line markdown. Here is the screenshot with comparison. <img src="/images/markdown-comparison.png" alt="Markdown code comparison Visual Studio" /></p>
</blockquote>

<p>Hit F5 and see the markdown tag helper in action. Below is the output I get.</p>

<p><img src="/images/output-markdown.png" alt="Markdown output" /></p>

<p>This is the simplest of all. Now let’s add some prefix to our custom TagHelper. To add a custom tag prefix to the TagHelper, we just need to pay a visit to <code>_ViewImports.cshtml</code> file again and add a new line like so:</p>

<pre class="brush: csharp">
@tagHelperPrefix "blog-"
</pre>

<p>After adding the above line in the file, go to the view page where you have used your custom TagHelper and you can notice that the <code>&lt;markdown&gt;</code> tag isn’t purple anymore. This is because we now have to add a custom tag-prefix that we just defined in the <code>_ViewImports.cshtml</code> file. Change it from <code>&lt;markdown&gt;</code> to <code>&lt;blog-markdown&gt;</code> and it is purple again.</p>

<p>By design, the TagHelper will take <code>&lt;markdown&gt;</code> as a tag to be processed. But it can be easily ignored by using the <code>HtmlTargetElement</code> attribute at the top of the class and allow the use of another name rather than <code>&lt;markdown&gt;</code>. This does not mean that you cannot use <code>&lt;markdown&gt;</code> but instead you can also use the custom TagHelper with the name specify in this attribute.</p>

<p>Now let’s add some attributes to my markdown TagHelper. Let’s try to add a url attribute which will help user to render the markdown on the view from a remote site like Github. To add an attribute, simply add a new public property of type string and call it url. When you create a public property in the <code>TagHelper</code> class it is automatically assumed it is an attribute. To make use of this property, my view now simply say this:</p>

<pre class="brush: csharp">
&lt;blog-markdown url="https://raw.githubusercontent.com/Knagis/CommonMark.NET/master/README.md">
&lt;/blog-markdown&gt;
</pre>

<p>The url attribute value is being read by the TagHelper which in turn read the whole string of markdown from Github and render the HTML on the page. Let’s focus again on TargetElement attribute for a while. Consider a scenario where you don’t want your custom TagHelper to render or work if the attributes are not passed or missing. This is where <code>HtmlTargetElement</code> attribute comes into picture. If I don’t want my TagHelper to work if the <code>url</code> parameter is missing then you can simple write your <code>HtmlTargetElement</code> attribute like so:</p>

<pre class="brush: csharp">
[HtmlTargetElement("markdown", Attributes = "url")]
</pre>

<p>Notice the <code>Attributes</code> parameter. The <code>Attributes</code> parameter allows you to set the name of all the attributes which should be processed by your TagHelper or else the TagHelper will not work. For instance, if I just use the <code>&lt;markdown&gt;</code> TagHelper but did not pass the url attribute, the TagHelper will not execute and you will see the raw markdown code. My requirement is to have this TagHelper working with or without the use of <code>url</code> attribute. I can comment out or remove the <code>HtmlTargetElement</code> attribute or just remove the <code>Attributes</code> parameter to get going.</p>

<p>Here is the complete MarkdownTagHelper.cs:</p>

<pre class="brush: csharp">
using Microsoft.AspNet.Razor.Runtime.TagHelpers;
using System;
using System.Net.Http;
using System.Threading.Tasks;
 
namespace WebApplication1.TagHelpers
{
    //[HtmlTargetElement("markdown", Attributes = "url")]
    public class MarkdownTagHelper : TagHelper
    {
        //Attribute for our custom markdown
        public string Url { get; set; }
 
        private string parse_content = string.Empty;
 
        //Stolen from: http://stackoverflow.com/questions/7578857/how-to-check-whether-a-string-is-a-valid-http-url
        private bool isValidURL(string URL)
        {
            Uri uriResult;
            return Uri.TryCreate(URL, UriKind.Absolute, out uriResult)
                && (uriResult.Scheme.ToLowerInvariant() == "http" || uriResult.Scheme.ToLowerInvariant() == "https");
        }
 
        public override async Task ProcessAsync(TagHelperContext context, TagHelperOutput output)
        {
            if (context.AllAttributes["url"] != null)
            {
                string url = context.AllAttributes["url"].Value.ToString();
                string webContent = string.Empty;
                if (url.Trim().Length &gt; 0)
                {
                    if (isValidURL(url))
                    {
                        using (HttpClient client = new HttpClient())
                        {
                            webContent = await client.GetStringAsync(new Uri(url));
                            parse_content = CommonMark.CommonMarkConverter.Convert(webContent);
                            output.Content.SetHtmlContent(parse_content);
                        }
                    }
                }
            }
            else
            {
                //Gets the content inside the markdown element
                var content = await output.GetChildContentAsync();
 
                //Read the content as a string and parse it.
                parse_content = CommonMark.CommonMarkConverter.Convert(content.GetContent());
 
                //Render the parsed markdown inside the tags.
                output.Content.SetHtmlContent(parse_content);
            }
        }
    }
}
</pre>

<p>I found the full TagHelper feature in MVC 6 a lot more convenient and powerful. I hope you like it as well.</p>

  </div>
  
</div>


<ul class="pagination">
    
    <li class="page-item">
        <a href="/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/page/4/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/4/">4</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/page/5/">5</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/6/">6</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/page/34/">34</a></li>
    
    
    <li class="page-item">
    <a href="/page/6/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/page/34/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


        </div>
        



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-QYXJT2TJCG', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeDefault.min.css"
  rel="stylesheet"
/>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCss.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushSql.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPowerShell.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushRuby.min.js"
></script>

<script>
  SyntaxHighlighter.defaults["gutter"] = true;
  SyntaxHighlighter.defaults["smart-tabs"] = true;
  SyntaxHighlighter.defaults["auto-links"] = true;
  SyntaxHighlighter.defaults["collapse"] = false;
  SyntaxHighlighter.defaults["light"] = false;
  SyntaxHighlighter.defaults["tab-size"] = 4;
  SyntaxHighlighter.defaults["toolbar"] = false;
  SyntaxHighlighter.defaults["wrap-lines"] = true;
  SyntaxHighlighter.all();
</script>


    </body>
</html>
